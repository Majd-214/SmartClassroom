<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>McMaster Smart Classroom - Student Handbook</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/product-sans" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        /* ====================================================================
      McMaster Smart Classroom - Consolidated Stylesheet
    ====================================================================
    */

        /* --- Global & Foundational Styles --- */
        body {
            font-family: 'Product Sans', sans-serif, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #202124;
            color: #e8eaed;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.7;
        }

        code,
        pre {
            font-family: 'Fira Code', 'Courier New', Courier, monospace;
        }

        /* --- Functional CSS (Animations, Scrollbar) --- */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background-color: #202124;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #3c4043;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: #5f6368;
        }

        /* --- Content-Area Styling (Scoped to '.page') --- */
        .page h1,
        .page h2,
        .page h3,
        .page h4 {
            color: #f1f3f4;
            font-weight: 700;
            border-bottom: 1px solid #3c4043;
            padding-bottom: 8px;
            margin-top: 24px;
            margin-bottom: 16px;
        }

        .page h1 {
            font-size: 2.5em;
            padding-bottom: 12px;
            text-align: center;
        }

        .page h2 {
            font-size: 2em;
        }

        .page h3 {
            font-size: 1.5em;
            border-bottom: none;
        }

        .page h4 {
            font-size: 1.2em;
            color: #bdc1c6;
            border-bottom: none;
            margin-top: 32px;
        }

        .page p {
            font-size: 1em;
            margin-bottom: 16px;
        }

        .page strong,
        .page b {
            color: #e8eaed;
            font-weight: 700;
        }

        .page a {
            color: #8ab4f8;
            text-decoration: none;
            transition: color 0.2s ease-in-out;
        }

        .page a:hover {
            color: #a7c5f9;
            text-decoration: underline;
        }

        .page ul,
        .page ol {
            padding-left: 20px;
        }

        .page li {
            margin-bottom: 8px;
        }

        .page li>p {
            margin-bottom: 0;
        }

        .page table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
            margin: 24px 0;
            border: 1px solid #3c4043;
            border-radius: 8px;
            overflow: hidden;
        }

        .page th,
        .page td {
            border-bottom: 1px solid #3c4043;
            padding: 12px 15px;
            text-align: left;
        }

        .page td {
            border-right: 1px solid #3c4043;
        }

        .page th:last-child,
        .page td:last-child {
            border-right: none;
        }

        .page tbody tr:last-child th,
        .page tbody tr:last-child td {
            border-bottom: none;
        }

        .page thead {
            background-color: #3c4043;
            color: #f1f3f4;
            font-weight: 700;
        }

        .page tbody tr:nth-child(even) {
            background-color: #282a2c;
        }

        .page hr {
            border: none;
            border-top: 1px solid #3c4043;
            margin: 40px 0;
        }

        /* --- Code Block & Syntax Highlighting --- */

        .page :not(pre)>code {
            background-color: #2d2e30;
            border: 1px solid #3c4043;
            padding: 2px 5px;
            font-size: 0.85em;
            border-radius: 6px;
        }

        .page pre {
            background-color: #1e1e1e;
            border: 1px solid #3c4043;
            border-radius: 8px;
            padding: 16px;
            overflow-x: auto;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            margin-top: 16px;
            margin-bottom: 16px;
        }

        .page pre code {
            background-color: transparent;
            border: none;
            padding: 0;
            border-radius: 0;
            font-size: 0.9em;
            line-height: 1.5;
            color: #e8eaed;
        }

        /* Specific syntax highlighting colors */
        .sh-preprocessor {
            color: #c586c0;
        }

        .sh-keyword {
            color: #569cd6;
        }

        .sh-type {
            color: #4ec9b0;
        }

        .sh-function {
            color: #dcdcaa;
        }

        .sh-variable {
            color: #9cdcfe;
        }

        .sh-string {
            color: #ce9178;
        }

        .sh-comment {
            color: #6a9955;
        }

        .sh-literal {
            color: #b5cea8;
        }

        .sh-info {
            color: #4ec9b0;
        }

        .sh-class {
            color: #4ec9b0;
        }

        .sh-operator {
            color: #d4d4d4;
        }

        .sh-number {
            color: #b5cea8;
        }

        /* Custom styles for the Overview (Instructor Briefing) page */
        .overview-section-header {
            font-family: 'Product Sans', sans-serif;
            font-weight: 900;
            text-transform: uppercase;
            border-bottom: none !important;
            padding-bottom: 0 !important;
        }

        .overview-card {
            background-color: #2D2E30;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .overview-gradient-heading {
            background: linear-gradient(90deg, #8ab4f8, #c1d9fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        .flow-step-border-accent {
            border-left-color: #8ab4f8;
        }

        .flow-step-border-primary {
            border-left-color: #e8eaed;
        }

        .flow-step-border-secondary {
            border-left-color: #bdc1c6;
        }

        /* New pastel colors for warnings */
        .flow-step-border-warning {
            border-left-color: #ffb300;
            /* Softer amber for border */
        }

        .bg-warning-tint {
            background-color: rgba(255, 179, 0, 0.08);
            /* Very light amber tint */
        }

        .text-error-red-soft {
            color: #ef5350;
            /* A standard Material Design red, kept for strong warning */
        }

        .flow-arrow {
            color: #8ab4f8;
        }

        /* Chart container styling as per requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Styles for code blocks within the infographic, to ensure consistency */
        .infographic-code-block pre {
            background-color: #1e1e1e;
            border: 1px solid #3c4043;
            border-radius: 8px;
            padding: 16px;
            overflow-x: auto;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            margin-top: 16px;
            margin-bottom: 16px;
        }

        .infographic-code-block pre code {
            background-color: transparent;
            border: none;
            padding: 0;
            border-radius: 0;
            font-size: 0.9em;
            line-height: 1.5;
            color: #e8eaed;
        }

        /* New styles for modern design elements */
        .highlight-box {
            background-color: rgba(138, 180, 248, 0.08);
            /* Light accent blue with transparency */
            border-left: 4px solid #8ab4f8;
            /* Accent blue border */
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            /* Adjust spacing */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .highlight-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .icon-large {
            font-size: 3rem;
            /* Larger icons for impact */
            color: #8ab4f8;
            /* Accent color for icons */
            margin-bottom: 0.5rem;
        }
    </style>
    <script>
        // Customizing Tailwind with the color scheme from the handbook
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'custom-bg': '#202124',
                        /* Original handbook background */
                        'surface': '#2d2e30',
                        /* Original handbook surface */
                        'primary': '#e8eaed',
                        /* Original handbook primary text */
                        'secondary': '#bdc1c6',
                        /* Original handbook secondary text */
                        'accent': '#8ab4f8',
                        /* Original handbook accent blue */
                        'custom-border': '#3c4043',
                        /* Original handbook border */

                        /* New colors for errors/warnings and additional blue accents */
                        'error-red': '#ef5350',
                        /* A standard Material Design red */
                        'warning-yellow': '#ffeb3b',
                        /* A standard Material Design yellow */
                        'info-blue': '#2196f3',
                        /* A standard Material Design blue */
                        'light-blue-accent': '#c1d9fd',
                        /* Lighter shade of accent */

                        /* Specific colors for the warning box */
                        'warning-tint': 'rgba(255, 179, 0, 0.08)', /* Softer amber tint for background */
                        'warning-border-color': '#FFB300', /* Softer amber for border */

                        'background-dark': '#202124',
                        'card-bg': '#2D2E30',
                    },
                    borderRadius: {
                        '4xl': '2rem',
                    },
                    fontFamily: {
                        product: ['Product Sans', 'sans-serif'],
                        /* Only Product Sans for main text */
                        fira: ['Fira Code', 'monospace'],
                        /* Only Fira Code for code */
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-custom-bg text-primary font-product">

    <nav class="sticky top-0 z-50 bg-surface/80 backdrop-blur-md border-b border-custom-border">
        <div class="max-w-5xl mx-auto px-4">
            <div class="flex items-center justify-center h-16">
                <div class="flex items-center space-x-2">
                    <a href="#" data-page="home"
                        class="nav-item px-4 py-2 text-sm font-medium rounded-xl transition-colors">Home</a>
                    <a href="#" data-page="overview"
                        class="nav-item px-4 py-2 text-sm font-medium rounded-xl transition-colors">Overview</a>
                    <div class="relative" id="dropdown-container">
                        <button id="nav-missions-btn" type="button"
                            class="nav-item flex items-center px-4 py-2 text-sm font-medium rounded-xl transition-colors focus:outline-none">
                            <span>Mission Briefings</span>
                            <svg class="ml-2 h-4 w-4 transition-transform duration-200" id="dropdown-arrow"
                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="dropdown-menu"
                            class="hidden absolute mt-2 w-64 bg-surface border border-custom-border rounded-xl shadow-lg py-1">
                            <a href="#" class="dropdown-item" data-page="station1">Station 1: HVAC & Appliance</a>
                            <a href="#" class="dropdown-item" data-page="station2">Station 2: Environmental Sensors</a>
                            <a href="#" class="dropdown-item" data-page="station3">Station 3: Smart Lighting</a>
                            <a href="#" class="dropdown-item" data-page="station4">Station 4: Door Security</a>
                            <a href="#" class="dropdown-item" data-page="station5">Station 5: Automated Curtain</a>
                            <a href="#" class="dropdown-item" data-page="station6">Station 6: Master Control Panel</a>
                        </div>
                    </div>
                    <a href="#" data-page="api-reference"
                        class="nav-item px-4 py-2 text-sm font-medium rounded-xl transition-colors">API Reference</a>
                    <a href="#" data-page="upload-troubleshoot"
                        class="nav-item px-4 py-2 text-sm font-medium rounded-xl transition-colors">Upload &
                        Troubleshoot</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto p-4 md:p-8">
        <div id="home" class="page">
            <h1 class="text-4xl md:text-5xl font-bold text-center text-primary mb-4">McMaster Smart Classroom</h1>
            <p class="text-center text-secondary text-lg mb-8">Welcome, Future Engineers! Your exciting mission at the
                McMaster Summer Camp is to work as a team of specialists to bring this Smart Classroom to life. Each
                group has been assigned a critical station. This handbook will guide you through your specific mission
                briefing and provide a detailed reference for the powerful <code>SmartDevice</code> library you'll be
                using.</p>

            <hr />

            <h2 class="text-3xl font-bold text-primary border-b border-custom-border pb-3 mb-6">1. Getting Started: The
                Universal Template</h2>
            <p class="text-secondary">For all stations, your journey begins with the
                <b><code>UniversalDeviceTemplate.ino</code></b> file. This template is designed to give you a clear,
                structured starting point by handling all the complex networking behind the scenes. Your main job is to
                "fill in the blanks" in the designated sections with your station's specific code.
            </p>

            <h3 class="text-xl font-bold text-primary mb-3">Understanding Your Template</h3>
            <p class="text-secondary">Open the template in your Arduino IDE:
                <code>File &gt; Examples &gt; SmartDevice &gt; UniversalDeviceTemplate</code>. You will see three main
                sections you need to interact with:
            </p>

            <ol class="list-decimal list-inside pl-4 space-y-4">
                <li>
                    <b>Configuration Section:</b>
                    <p class="text-secondary mt-2">At the very top of the file, you'll find parameters to identify your
                        device and its communication channels. You <b>must</b> change these to match your station's
                        assignment:</p>
                    <pre><code><span class="sh-comment">// Give your device a unique name to identify it on the network.</span>
<span class="sh-keyword">const char*</span> <span class="sh-variable">DEVICE_NAME</span> = <span class="sh-string">"My_Station_Device"</span>; <span class="sh-comment">// &lt;-- CHANGE THIS! e.g., "Sarah_Door_Lock"</span>

<span class="sh-keyword">const char*</span> <span class="sh-variable">COMMAND_TOPIC</span> = <span class="sh-string">"classroom/some_device/command"</span>; <span class="sh-comment">// &lt;-- CHANGE for your station</span>
<span class="sh-keyword">const char*</span> <span class="sh-variable">STATUS_TOPIC</span> = <span class="sh-string">"classroom/some_device/status"</span>;   <span class="sh-comment">// &lt;-- CHANGE for your station</span></code></pre>
                </li>
                <li>
                    <b><code>setupMyHardware()</code> Function:</b>
                    <p class="text-secondary mt-2">This function runs <b>only once</b> when your ESP8266 first starts
                        up. It's the perfect place to:</p>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>Initialize your hardware components (e.g., set pin modes, start sensors, attach servos).
                        </li>
                        <li>Prepare any libraries your sensors or actuators need.</li>
                    </ul>
                    <p class="text-secondary mt-2">Think of it as setting up your workstation before you begin your main
                        project.</p>
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">setupMyHardware</span>() {
  <span class="sh-comment">// Your hardware setup code goes here.</span>
  <span class="sh-comment">// EXAMPLE: pinMode(PIN_D7, OUTPUT); // Configure D7 as an output</span>
}</code></pre>
                </li>
                <li>
                    <b><code>loopMySensorLogic()</code> Function:</b>
                    <p class="text-secondary mt-2">This function runs <b>repeatedly, many times per second</b>, after
                        <code>setupMyHardware()</code> is complete. It's ideal for:
                    </p>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>Continuously reading data from sensors.</li>
                        <li>Sending periodic updates or sensor readings to the cloud.</li>
                        <li>Any tasks that need to happen over and over again.</li>
                    </ul>
                    <p class="text-secondary mt-2">This is where you'll tell your device to keep an eye on things.</p>
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">loopMySensorLogic</span>() {
  <span class="sh-comment">// Your sensor reading and data publishing logic goes here.</span>
  <span class="sh-comment">// EXAMPLE: int buttonState = digitalRead(PIN_D1); // Read a button</span>
  <span class="sh-comment">// EXAMPLE: myDevice.publishTo(STATUS_TOPIC, String(buttonState)); // Send button state</span>
}</code></pre>
                </li>
                <li>
                    <b><code>handleMyActuatorLogic(String command)</code> Function:</b>
                    <p class="text-secondary mt-2">This function runs <b>only when your device receives a command</b>
                        from the central hub (e.g., "turn light on"). It's perfect for:</p>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>Controlling actuators (like lights, motors, relays) based on incoming instructions.</li>
                        <li>Responding to specific commands with actions.</li>
                        <li>(For Station 6 - Master Control Panel: You will replace the default use of this function
                            with a more advanced callback as explained in your mission briefing).</li>
                    </ul>
                    <p class="text-secondary mt-2">This is where your device takes action based on external
                        instructions.</p>
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">handleMyActuatorLogic</span>(<span class="sh-type">String</span> <span class="sh-variable">command</span>) {
  <span class="sh-comment">// Your actuator control logic goes here.</span>
  <span class="sh-comment">// EXAMPLE: if (command == "LIGHT_ON") { digitalWrite(PIN_D7, HIGH); }</span>
}</code></pre>
                </li>
            </ol>

            <hr />

            <h2 class="text-3xl font-bold text-primary border-b border-custom-border pb-3 mb-6">2. Core Networking: The
                "System Engine"</h2>
            <p class="text-secondary">Below the sections you will modify, you'll find the "System Engine" code. This
                part handles all the behind-the-scenes magic of connecting to Wi-Fi, managing communication with the
                central hub, and ensuring your device stays online. <b>You should NOT modify this section.</b> It's the
                robust foundation for your project!</p>
            <p class="text-secondary">Key elements handled by the System Engine include:</p>
            <ul class="list-disc list-inside pl-4 space-y-2">
                <li>Initializing the <code>SmartDevice</code> library.</li>
                <li>Connecting to the Wi-Fi network using the provided credentials.</li>
                <li>Establishing and maintaining the connection to the MQTT broker (the central message server).</li>
                <li>Subscribing to your device's specific command topic.</li>
                <li>Calling your <code>setupMyHardware()</code>, <code>loopMySensorLogic()</code>, and
                    <code>handleMyActuatorLogic()</code> functions at the appropriate times.
                </li>
            </ul>

            <div class="mt-8 bg-accent/10 border border-accent/30 border-l-4 border-l-accent px-6 py-4 rounded-xl">
                <h4 class="font-bold text-lg text-accent mb-2">Common Network Information</h4>
                <p class="text-sm text-accent/80 mb-3">You will need this information for the configuration section of
                    your code. It should also be on the main whiteboard.</p>
                <ul class="list-disc list-inside text-sm space-y-2">
                    <li><b>Wi-Fi Network (SSID):</b> <code>McMasterIoT-Camp</code></li>
                    <li><b>Wi-Fi Password:</b> <code>Roomba2025</code></li>
                    <li><b>Hub IP Address:</b> <code>192.168.0.147</code> (confirm with instructor)</li>
                </ul>
            </div>
        </div>

        <div id="overview" class="page">
            <!-- Palette: Original Handbook Theme -->
            <!-- Background: #202124, Surface: #2d2e30, Primary: #e8eaed, Secondary: #bdc1c6, Accent: #8ab4f8, Border: #3c4043 -->
            <!-- NEITHER Mermaid JS NOR SVG were used in this output. -->

            <!-- Section 1: The Mission - Introduction -->
            <section class="text-center py-12">
                <h1 class="text-4xl md:text-6xl overview-section-header overview-gradient-heading">Instructor Briefing
                </h1>
                <p class="mt-4 text-lg md:text-xl text-secondary max-w-3xl mx-auto">Welcome, Future Engineers! Your
                    mission is to build a living, intelligent classroom system, piece by piece.</p>
                <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    <div class="overview-card p-6 rounded-2xl">
                        <p class="text-6xl font-extrabold text-accent"><span
                                class="material-icons text-7xl align-middle">system_update_alt</span></p>
                        <p class="mt-2 text-xl font-bold">Integrated System</p>
                    </div>
                    <div class="overview-card p-6 rounded-2xl">
                        <p class="text-6xl font-extrabold text-accent"><span
                                class="material-icons text-7xl align-middle">handyman</span></p>
                        <p class="mt-2 text-xl font-bold">Specialized Stations</p>
                    </div>
                    <div class="overview-card p-6 rounded-2xl">
                        <p class="text-6xl font-extrabold text-accent"><span
                                class="material-icons text-7xl align-middle">rocket_launch</span></p>
                        <p class="mt-2 text-xl font-bold">Limitless Innovation</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Your Core Toolkit -->
            <section class="py-12">
                <h2 class="text-3xl md:text-4xl overview-section-header text-center text-primary">Your <span
                        class="text-accent">Core Toolkit</span></h2>
                <p class="mt-4 text-lg text-secondary text-center max-w-3xl mx-auto">You'll harness the power of a tiny
                    computer and a versatile programming environment.</p>
                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="overview-card p-8 rounded-2xl text-center">
                        <p class="text-4xl"><span class="material-icons text-5xl align-middle">memory</span></p>
                        <h3 class="mt-4 text-2xl font-bold text-primary">ESP8266</h3>
                        <p class="text-secondary">The compact, Wi-Fi-enabled microcontroller that acts as the brain for
                            your IoT device.</p>
                    </div>
                    <div class="overview-card p-8 rounded-2xl text-center">
                        <p class="text-4xl"><span class="material-icons text-5xl align-middle">code</span></p>
                        <h3 class="mt-4 text-2xl font-bold text-primary">Arduino IDE</h3>
                        <p class="text-secondary">Your integrated development environment for writing, compiling, and
                            uploading C++ code to the ESP8266.</p>
                    </div>
                </div>
            </section>


            <!-- Section 3: The Universal Template Workflow -->
            <section class="py-12">
                <h2 class="text-3xl md:text-4xl overview-section-header text-center text-primary">Your Workflow: The
                    <span class="text-accent">Universal Template</span>
                </h2>
                <p class="mt-4 text-lg text-secondary text-center max-w-3xl mx-auto">Every station begins with the same
                    <code>UniversalDeviceTemplate.ino</code>. We've pre-configured the complex networking, so you can
                    focus on your unique hardware logic.
                </p>

                <div class="mt-12 grid grid-cols-1 gap-8">
                    <!-- Step 1: Configure -->
                    <div
                        class="overview-card p-6 rounded-2xl flex items-start gap-4 border-l-4 flow-step-border-accent">
                        <div class="flex-shrink-0 text-3xl font-bold text-accent">1</div>
                        <div>
                            <h3 class="text-2xl font-bold text-primary">Configure Device Identity</h3>
                            <p class="text-secondary mt-2">Locate the "Configuration Section" at the top of your
                                <code>UniversalDeviceTemplate.ino</code>. You <b>must</b> update
                                <code>DEVICE_NAME</code>, <code>COMMAND_TOPIC</code>, and <code>STATUS_TOPIC</code> with
                                the unique values provided by your instructor. This tells the network who your device is
                                and how it communicates.
                            </p>
                            <div
                                class="infographic-code-block mt-4 p-3 bg-background-dark rounded-lg font-mono text-sm text-secondary">
                                <code><span class="sh-keyword">const char*</span> <span class="sh-variable">DEVICE_NAME</span> = <span class="sh-string">"My_Station_Device"</span>;<span class="sh-comment"> // &lt;-- CHANGE!</span></code><br />
                                <code><span class="sh-keyword">const char*</span> <span class="sh-variable">COMMAND_TOPIC</span> = <span class="sh-string">"classroom/your/command"</span>;<span class="sh-comment"> // &lt;-- CHANGE!</span></code><br />
                                <code><span class="sh-keyword">const char*</span> <span class="sh-variable">STATUS_TOPIC</span> = <span class="sh-string">"classroom/your/status"</span>;<span class="sh-comment"> // &lt;-- CHANGE!</span></code>
                            </div>
                        </div>
                    </div>
                    <div class="text-center text-4xl py-4 flow-arrow">↓</div>

                    <!-- Step 2: Write Code in Functions - REVISED DISPLAY -->
                    <div
                        class="overview-card p-6 rounded-2xl flex items-start gap-4 border-l-4 flow-step-border-accent">
                        <div class="flex-shrink-0 text-3xl font-bold text-accent">2</div>
                        <div>
                            <h3 class="text-2xl font-bold text-primary">Write Your Logic in Core Functions</h3>
                            <p class="text-secondary mt-2">Your specific hardware logic goes into three dedicated
                                functions.
                                Understanding when each runs is crucial:</p>

                            <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="highlight-box">
                                    <span class="material-icons icon-large">build_circle</span>
                                    <h4 class="font-bold text-accent"><code>setupMyHardware()</code></h4>
                                    <p class="text-sm text-secondary">Executes <b>ONCE</b> at startup. Ideal for pin
                                        configuration (<code>pinMode</code>), sensor initialization, and attaching
                                        components like servos.</p>
                                </div>
                                <div class="highlight-box">
                                    <span class="material-icons icon-large">autorenew</span>
                                    <h4 class="font-bold text-accent"><code>loopMySensorLogic()</code></h4>
                                    <p class="text-sm text-secondary">Runs <b>REPEATEDLY</b> (many times/sec). Use for
                                        continuous sensor readings and periodically publishing data to the cloud
                                        (<code>myDevice.publishTo()</code>).</p>
                                </div>
                                <div class="highlight-box">
                                    <span class="material-icons icon-large">bolt</span>
                                    <h4 class="font-bold text-accent">
                                        <code>handleMyActuatorLogic<br>(String command)</code>
                                    </h4>
                                    <p class="text-sm text-secondary">Executes <b>ON-DEMAND</b> when your device
                                        receives a
                                        command. Perfect for controlling actuators (lights, motors) and reporting their
                                        new
                                        status.</p>
                                </div>
                            </div>
                            <p class="text-secondary text-center mt-4 text-sm">The functions above run in different
                                frequencies. <code>setupMyHardware()</code> runs once, while
                                <code>loopMySensorLogic()</code> runs continuously. <code>handleMyActuatorLogic()</code>
                                runs only when a command is received.
                            </p>
                        </div>
                    </div>
                    <div class="text-center text-4xl py-4 flow-arrow">↓</div>

                    <!-- Step 3: The System Engine - WARNING REVISED -->
                    <div
                        class="overview-card p-6 rounded-2xl flex items-start gap-4 border-l-4 flow-step-border-warning bg-warning-tint">
                        <div class="flex-shrink-0 text-3xl font-bold text-warning-border-color">3</div>
                        <div>
                            <h3 class="text-2xl font-bold text-primary">The "System Engine": Hands-Off Zone!</h3>
                            <p class="text-secondary mt-2">Below your code sections lies the critical "System Engine".
                                This automatically handles all Wi-Fi and MQTT connections, ensuring your device stays
                                online and communicates. <b class="text-error-red-soft">DO NOT EDIT THIS SECTION.</b>
                                Any changes here could prevent
                                your device from connecting.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 4: Going Live & Troubleshooting -->
            <section class="py-12">
                <h2 class="text-3xl md:text-4xl overview-section-header text-center text-primary">Going <span
                        class="text-accent">Live</span> & Debugging</h2>
                <p class="mt-4 text-lg text-secondary text-center max-w-3xl mx-auto">Even experts hit roadblocks. This
                    guide will help you upload your code and tackle common issues.</p>
                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                    <div class="overview-card p-6 rounded-2xl h-full">
                        <h3 class="text-2xl font-bold text-primary">4-Step Code Upload</h3>
                        <ol class="mt-4 list-decimal list-inside space-y-3 text-secondary">
                            <li><b>Select Board:</b> In Arduino IDE, go to
                                <code>Tools &gt; Board &gt; ESP8266 Boards</code> and choose
                                <code>Generic ESP8266 Module</code>.
                            </li>
                            <li><b>Select Port:</b> Go to <code>Tools &gt; Port</code> and select the serial port
                                connected to your ESP8266. Unplug and replug to identify it if needed.</li>
                            <li><b>Enter Flash Mode (If necessary):</b>
                                <p class="mt-2 text-sm">If your board doesn't automatically upload, manually trigger
                                    flash mode:</p>
                                <ol class="list-[lower-alpha] list-inside ml-4 mt-1 space-y-1">
                                    <li><b>Unplug</b> your ESP8266 board.</li>
                                    <li><b>Hold down the "FLASH" or "BOOT" button</b> on the board.</li>
                                    <li>While holding the button, <b>plug the USB cable back in</b>.</li>
                                    <li>Release the button after 1-2 seconds.</li>
                                </ol>
                            </li>
                            <li><b>Upload & Monitor:</b> Click the "Upload" (right-arrow) button. Once uploaded, open
                                the "Serial Monitor" (magnifying glass icon) and set baud rate to <code>115200</code>.
                            </li>
                        </ol>
                    </div>
                    <div class="overview-card p-6 rounded-2xl h-full flex flex-col justify-between">
                        <h3 class="text-2xl font-bold text-primary text-center">Common Bug Hotspots</h3>
                        <p class="text-secondary text-center mt-2">Where engineers spend most of their time! Know these
                            common issues.</p>
                        <div class="chart-container flex-grow pt-4">
                            <canvas id="troubleshootingChart"></canvas>
                        </div>
                        <p class="text-sm text-secondary text-center mt-4">Proportion of common troubleshooting areas.
                        </p>
                    </div>
                </div>
                <div class="mt-8 p-6 overview-card rounded-2xl border-l-4 border-accent">
                    <h4 class="text-xl font-bold text-accent">Debugging with <code>Serial.println()</code></h4>
                    <p class="text-secondary mt-2">Your best debugging tool! Use
                        <code>Serial.println("Your message here");</code> to print values, check logic paths, and see
                        what your device is doing in real-time in the Serial Monitor. This is invaluable for pinpointing
                        problems!
                    </p>
                </div>
            </section>

            <!-- Section 5: The 6 Stations -->
            <section class="py-12 text-center">
                <h2 class="text-3xl md:text-4xl overview-section-header text-primary">One Team, <span
                        class="overview-gradient-heading">Six Missions</span></h2>
                <p class="mt-4 text-lg text-secondary max-w-3xl mx-auto">Each station plays a vital role. Together, your
                    devices form the complete Smart Classroom system!</p>
                <div class="mt-8 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 md:gap-6">
                    <div class="overview-card p-4 rounded-2xl">
                        <p class="text-4xl"><span class="material-icons text-5xl align-middle">ac_unit</span></p>
                        <p class="font-bold mt-2">HVAC</p>
                    </div>
                    <div class="overview-card p-4 rounded-2xl">
                        <p class="text-4xl"><span class="material-icons text-5xl align-middle">thermostat</span></p>
                        <p class="font-bold mt-2">Sensors</p>
                    </div>
                    <div class="overview-card p-4 rounded-2xl">
                        <p class="text-4xl"><span class="material-icons text-5xl align-middle">lightbulb</span></p>
                        <p class="font-bold mt-2">Lighting</p>
                    </div>
                    <div class="overview-card p-4 rounded-2xl">
                        <p class="text-4xl"><span class="material-icons text-5xl align-middle">lock</span></p>
                        <p class="font-bold mt-2">Security</p>
                    </div>
                    <div class="overview-card p-4 rounded-2xl">
                        <p class="text-4xl"><span class="material-icons text-5xl align-middle">blinds_closed</span></p>
                        <p class="font-bold mt-2">Curtain</p>
                    </div>
                    <div class="overview-card p-4 rounded-2xl">
                        <p class="text-4xl"><span class="material-icons text-5xl align-middle">tune</span></p>
                        <p class="font-bold mt-2">Panel</p>
                    </div>
                </div>
            </section>
        </div>

        <div id="station1" class="page">
            <h2 class="text-3xl font-bold text-primary border-b border-custom-border pb-3 mb-6">Station 1: HVAC &
                Appliance Control</h2>
            <h3 class="text-xl font-bold text-primary mb-3">Your Mission: Climate &amp; Convenience Commanders</h3>
            <p class="text-secondary">You are the <b>Climate &amp; Appliance Team</b>. Your mission is to give the
                central hub remote control over two high-power devices: a fan (simulating an HVAC system) and an
                electric kettle. You'll use special, pre-wired relay modules that act like smart switches, allowing your
                low-power ESP8266 to safely turn these devices on and off. This station is crucial for maintaining a
                comfortable and convenient smart home environment!</p>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Real-World Application:</h4>
            <p class="text-secondary">Think about smart thermostats like Nest or Ecobee that learn your preferences, or
                smart plugs that let you control any appliance from your phone. You're building the core intelligence
                behind such systems, enabling energy efficiency and automated comfort.</p>

            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Hardware Kit</h4>
            <ul class="list-disc list-inside pl-4 space-y-1">
                <li>1x ESP8266 Board &amp; Breadboard</li>
                <li>1x Custom HVAC Power Plug (Relay)</li>
                <li>1x Custom Kettle Power Plug (Relay)</li>
            </ul>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Wiring Guide</h4>
            <p class="text-secondary mb-4">Relays are essentially remote-controlled switches. They have a signal pin
                that connects to your ESP8266. When your ESP sends a <code>HIGH</code> signal to this pin, the relay
                closes an internal switch, allowing power to flow to the connected device (turning it ON). A
                <code>LOW</code> signal opens the switch, turning the device OFF. Always ensure you connect the grounds
                of your ESP and relays together!
            </p>
            <img src="https://miro.medium.com/v2/resize:fit:860/0*a5aOqIFrD3mirbyw.png"
                alt="Wiring Diagram for Station 1" class="w-full rounded-2xl my-4 border border-custom-border"
                onerror="this.onerror=null; this.src='https://placehold.co/860x484/2d2e30/e8eaed?text=Wiring+Diagram+Placeholder';">
            <ol class="list-decimal list-inside pl-4 space-y-2">
                <li><b>HVAC Relay:</b> Connect its <b>Signal</b> wire to pin <code>PIN_D7</code>. Connect its
                    <b>Ground</b> wire to a <code>GND</code> pin on your ESP8266.
                </li>
                <li><b>Kettle Relay:</b> Connect its <b>Signal</b> wire to pin <code>PIN_D6</code>. Connect its
                    <b>Ground</b> wire to another <code>GND</code> pin on your ESP8266.
                </li>
            </ol>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Coding Mission: Step-by-Step</h4>
            <p class="text-secondary">Your station acts as an actuator&mdash;it reacts to commands. You will primarily
                write code in the <code>setupMyHardware()</code> and <code>handleMyActuatorLogic()</code> functions
                within your <code>UniversalDeviceTemplate.ino</code>.</p>
            <ul class="list-disc list-inside pl-4 space-y-2">
                <li><b>Configuration:</b> Update the <code>DEVICE_NAME</code>, <code>COMMAND_TOPIC</code>, and
                    <code>STATUS_TOPIC</code> in your template:
                    <pre><code><span class="sh-keyword">const char*</span> <span class="sh-variable">DEVICE_NAME</span> = <span class="sh-string">"YourName_HVAC"</span>; <span class="sh-comment">// e.g., "Sarah_HVAC"</span>
<span class="sh-keyword">const char*</span> <span class="sh-variable">COMMAND_TOPIC</span> = <span class="sh-string">"classroom/hvac/command"</span>;
<span class="sh-keyword">const char*</span> <span class="sh-variable">STATUS_TOPIC</span> = <span class="sh-string">"classroom/hvac/status"</span>;</code></pre>
                </li>
                <li><b>Define Pins (Recommended):</b> After the <code>#include &lt;SmartDevice.h&gt;</code> line, define
                    constants for your pins to make your code more readable:
                    <pre><code><span class="sh-preprocessor">#define</span> <span class="sh-variable">HVAC_RELAY_PIN</span> <span class="sh-variable">PIN_D7</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">KETTLE_RELAY_PIN</span> <span class="sh-variable">PIN_D6</span></code></pre>
                </li>
                <li><b><code>setupMyHardware()</code>:</b> In this function, you'll configure your relay pins as outputs
                    and ensure they start in a safe (OFF) state.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">setupMyHardware</span>() {
  <span class="sh-comment">// Configure both relay pins as outputs</span>
  <span class="sh-function">pinMode</span>(HVAC_RELAY_PIN, <span class="sh-literal">OUTPUT</span>);
  <span class="sh-function">pinMode</span>(KETTLE_RELAY_PIN, <span class="sh-literal">OUTPUT</span>);
  <span class="sh-comment">// Ensure both relays start OFF to prevent unexpected activations</span>
  <span class="sh-function">digitalWrite</span>(HVAC_RELAY_PIN, <span class="sh-literal">LOW</span>);
  <span class="sh-function">digitalWrite</span>(KETTLE_RELAY_PIN, <span class="sh-literal">LOW</span>);

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// If you had a small LED on PIN_D5, you might do:</span>
  <span class="sh-comment">// pinMode(PIN_D5, OUTPUT);</span>
  <span class="sh-comment">// digitalWrite(PIN_D5, HIGH); // Turn it on briefly for a "booted" indicator</span>
}</code></pre>
                </li>
                <li><b><code>handleMyActuatorLogic(String command)</code>:</b> This is where you'll write the logic to
                    control your relays based on the incoming <code>command</code> string. Remember to report the status
                    back to the cloud using <code>myDevice.publishTo()</code>.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">handleMyActuatorLogic</span>(<span class="sh-type">String</span> <span class="sh-variable">command</span>) {
  <span class="sh-comment">// This function runs when a command is received.</span>
  <span class="sh-comment">// Use if/else if statements to check the 'command' payload.</span>

  <span class="sh-comment">// For HVAC commands:</span>
  <span class="sh-keyword">if</span> (<span class="sh-variable">command</span> == <span class="sh-string">"HVAC_ON"</span>) {
    digitalWrite(HVAC_RELAY_PIN, HIGH);
    myDevice.publishTo(STATUS_TOPIC, "ON");
  } <span class="sh-keyword">else if</span> (<span class="sh-variable">command</span> == <span class="sh-string">"HVAC_OFF"</span>) {
    digitalWrite(HVAC_RELAY_PIN, LOW);
    myDevice.publishTo(STATUS_TOPIC, "OFF");
  }
  <span class="sh-comment">// For Kettle commands:</span>
  <span class="sh-keyword">else if</span> (<span class="sh-variable">command</span> == <span class="sh-string">"KETTLE_ON"</span>) {
    digitalWrite(KETTLE_RELAY_PIN, HIGH);
    myDevice.publishTo("classroom/hvac/kettle_status", "ON");
  } <span class="sh-keyword">else if</span> (<span class="sh-variable">command</span> == <span class="sh-string">"KETTLE_OFF"</span>) {
    digitalWrite(KETTLE_RELAY_PIN, LOW);
    myDevice.publishTo("classroom/hvac/kettle_status", "OFF");
  }

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// If you also had a button that controlled a separate LED:</span>
  <span class="sh-comment">// if (command == "BLINK_LED") {</span>
  <span class="sh-comment">//   for (int i = 0; i < 5; i++) {</span>
  <span class="sh-comment">//     digitalWrite(PIN_D5, HIGH); delay(100);</span>
  <span class="sh-comment">//     digitalWrite(PIN_D5, LOW); delay(100);</span>
  <span class="sh-comment">//   }</span>
  <span class="sh-comment">// }</span>
}</code></pre>
                </li>
            </ul>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Success Criteria</h4>
            <p class="text-secondary">Your mission is a success when you can independently control both the fan (HVAC)
                and the kettle from the central dashboard or via voice commands, and their ON/OFF status updates
                correctly on the dashboard. Ask your instructor to test it!</p>
            <div class="mt-8 bg-accent/10 border border-accent/30 border-l-4 border-l-accent px-6 py-4 rounded-xl">
                <h5 class="font-bold text-accent mb-2">Challenges &amp; Tips:</h5>
                <ul class="list-disc list-inside text-sm text-accent/80 space-y-2">
                    <li><b>Initial State:</b> Ensure your relays are OFF when the device first starts to prevent
                        unexpected appliance activation. You can do this in <code>setupMyHardware()</code>.</li>
                    <li><b>Debugging:</b> Use <code>Serial.println()</code> statements in your
                        <code>handleMyActuatorLogic</code> function to see what payloads you're receiving and confirm
                        your logic is being executed.
                    </li>
                    <li><b>Power Considerations:</b> Relays can sometimes draw a bit more current than regular LEDs.
                        Make sure your ESP8266 is powered correctly (usually via USB).</li>
                </ul>
            </div>
        </div>

        <div id="station2" class="page">
            <h2 class="text-3xl font-bold text-primary border-b border-custom-border pb-3 mb-6">Station 2: Environmental
                &amp; Security Sensors</h2>
            <h3 class="text-xl font-bold text-primary mb-3">Your Mission: The Classroom's Senses</h3>
            <p class="text-secondary">You are the <b>Sensor Integration Team</b>. Your task is to become the "eyes and
                ears" of the Smart Classroom by continuously monitoring three different types of sensors: a DHT11 for
                precise temperature readings, a PIR sensor for motion detection, and a magnetic contact switch to detect
                if a window is open or closed. Your data will provide the hub with crucial information for automated
                responses!</p>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Real-World Application:</h4>
            <p class="text-secondary">This is how smart homes know what's going on! Think about intelligent climate
                control that reacts to temperature changes, security systems that detect intruders with motion and door
                sensors, or even smart ventilation systems. Your work here is fundamental to an intelligent building.
            </p>

            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Hardware Kit</h4>
            <ul class="list-disc list-inside pl-4 space-y-1">
                <li>1x ESP8266 Board</li>
                <li>1x DHT11 Temperature</li>
                <li>1x PIR Motion Sensor</li>
                <li>1x Magnetic Contact Switch (for window)</li>
            </ul>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Wiring Guide</h4>
            <p class="text-secondary mb-4">Each sensor connects slightly differently, but the principles of power,
                ground, and a signal pin remain. The DHT11 needs power and a single data line. The PIR sensor is
                similar. The contact switch is the simplest; it's just a switch that completes a circuit when open or
                closed.</p>
            <img src="https://cherryelectronics.in/wp-content/uploads/2024/06/DHT11.png"
                alt="Wiring Diagram for Station 2 (Example for DHT11/22)"
                class="w-full rounded-2xl my-4 border border-custom-border"
                onerror="this.onerror=null; this.src='https://placehold.co/800x450/2d2e30/e8eaed?text=DHT11+Wiring+Diagram+Placeholder';">
            <ol class="list-decimal list-inside pl-4 space-y-2">
                <li><b>DHT11:</b> Connect its <b>Data</b> pin to <code>PIN_D2</code>, <b>VCC/Vin</b> (positive power) to
                    <code>3V3</code>, and <b>GND</b> (ground) to <code>GND</code> on your ESP8266.
                </li>
                <li><b>PIR Sensor:</b> Connect its <b>OUT</b> (signal) pin to <code>PIN_D5</code>, <b>VCC</b> to
                    <code>3V3</code>, and <b>GND</b> to <code>GND</code>.
                </li>
                <li><b>Window Sensor (Magnetic Contact Switch):</b> This is a simple switch. Connect one wire of the
                    switch to <code>PIN_D1</code> and the other wire to <code>GND</code>. We will use the ESP's special
                    internal pull-up resistor for this.</li>
            </ol>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Coding Mission: Step-by-Step</h4>
            <p class="text-secondary">Your station uses sensors&mdash;it senses the world and reports data. You will
                primarily write code in the <code>setupMyHardware()</code> and <code>loopMySensorLogic()</code>
                functions within your <code>UniversalDeviceTemplate.ino</code>. The <code>handleMyActuatorLogic()</code>
                will not be used by this station.</p>
            <ul class="list-disc list-inside pl-4 space-y-2">
                <li><b>Configuration &amp; Libraries:</b> Update the <code>DEVICE_NAME</code>,
                    <code>COMMAND_TOPIC</code>, and <code>STATUS_TOPIC</code>. Also, add the DHT library and define your
                    sensor objects and pins:
                    <pre><code><span class="sh-preprocessor">#include</span> <span class="sh-string">&lt;DHT.h&gt;</span>

<span class="sh-keyword">const char*</span> <span class="sh-variable">DEVICE_NAME</span> = <span class="sh-string">"YourName_EnviroSensor"</span>; <span class="sh-comment">// e.g., "Alex_EnviroSensor"</span>
<span class="sh-keyword">const char*</span> <span class="sh-variable">COMMAND_TOPIC</span> = <span class="sh-string">"classroom/environment/command"</span>; <span class="sh-comment">// Not typically used for sensors, but define for consistency.</span>
<span class="sh-keyword">const char*</span> <span class="sh-variable">STATUS_TOPIC</span> = <span class="sh-string">"classroom/environment/status"</span>;

<span class="sh-comment">// DHT sensor setup</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">DHTPIN</span> <span class="sh-variable">PIN_D2</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">DHTTYPE</span> <span class="sh-variable">DHT11</span>
<span class="sh-class">DHT</span> dht(DHTPIN, DHTTYPE);

<span class="sh-preprocessor">#define</span> <span class="sh-variable">PIR_PIN</span> <span class="sh-variable">PIN_D5</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">WINDOW_PIN</span> <span class="sh-variable">PIN_D1</span></code></pre>
                </li>
                <li><b><code>setupMyHardware()</code>:</b> Initialize your DHT sensor and set pin modes for the PIR and
                    window sensors.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">setupMyHardware</span>() {
  dht.<span class="sh-function">begin</span>(); <span class="sh-comment">// Start the DHT sensor.</span>
  <span class="sh-function">pinMode</span>(PIR_PIN, <span class="sh-literal">INPUT</span>); <span class="sh-comment">// PIR sensor output is an input to the ESP.</span>
  <span class="sh-function">pinMode</span>(WINDOW_PIN, <span class="sh-literal">INPUT_PULLUP</span>); <span class="sh-comment">// Use internal pull-up resistor for window sensor.</span>

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// If you had an analog sensor on A0:</span>
  <span class="sh-comment">// Serial.println("Analog sensor ready!");</span>
}</code></pre>
                </li>
                <li><b><code>loopMySensorLogic()</code>:</b> This is where you will continuously read all your sensors,
                    combine the data into the required string formats, and publish them to the cloud.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">loopMySensorLogic</span>() {
  <span class="sh-comment">// This function runs repeatedly to read sensors and send data.</span>
  <span class="sh-comment">// Read temperature from DHT11.</span>
  <span class="sh-type">float</span> temp = dht.<span class="sh-function">readTemperature</span>();

  <span class="sh-comment">// Read motion detection from PIR sensor.</span>
  <span class="sh-type">bool</span> motionDetected = (<span class="sh-function">digitalRead</span>(PIR_PIN) <span class="sh-operator">==</span> <span class="sh-literal">HIGH</span>);

  <span class="sh-comment">// Only publish if DHT readings are valid.</span>
  <span class="sh-keyword">if</span> (<span class="sh-operator">!</span><span class="sh-function">isnan</span>(temp)) {
    <span class="sh-comment">// Construct the combined payload for environmental data (e.g., "temp:22.5,motion:true").</span>
    <span class="sh-type">String</span> enviroPayload = <span class="sh-string">"temp:"</span> <span class="sh-operator">+</span> <span class="sh-type">String</span>(temp) <span class="sh-operator">+</span> <span class="sh-string">",motion:"</span> <span class="sh-operator">+</span> (motionDetected <span class="sh-operator">?</span> <span class="sh-string">"true"</span> <span class="sh-operator">:</span> <span class="sh-string">"false"</span>);
    myDevice.<span class="sh-function">publishTo</span>(<span class="sh-string">"classroom/environment/data"</span>, enviroPayload);
    Serial.<span class="sh-function">print</span>(<span class="sh-string">"Environmental data sent: "</span>); Serial.<span class="sh-function">println</span>(enviroPayload);
  } <span class="sh-keyword">else</span> {
    Serial.<span class="sh-function">println</span>(<span class="sh-string">"Failed to read from DHT sensor!"</span>);
  }

  <span class="sh-comment">// Read window sensor status and publish separately.</span>
  <span class="sh-comment">// LOW means the switch is closed (magnet is near), indicating the window is CLOSED.</span>
  <span class="sh-type">bool</span> isWindowClosed = (<span class="sh-function">digitalRead</span>(WINDOW_PIN) <span class="sh-operator">==</span> <span class="sh-literal">LOW</span>); 
  myDevice.<span class="sh-function">publishTo</span>(<span class="sh-string">"classroom/environment/window_status"</span>, isWindowClosed <span class="sh-operator">?</span> <span class="sh-string">"CLOSED"</span> <span class="sh-operator">:</span> <span class="sh-string">"OPEN"</span>);
  Serial.<span class="sh-function">print</span>(<span class="sh-string">"Window status sent: "</span>); Serial.<span class="sh-function">println</span>(isWindowClosed <span class="sh-operator">?</span> <span class="sh-string">"CLOSED"</span> <span class="sh-operator">:</span> <span class="sh-string">"OPEN"</span>);

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// If you wanted to read an analog light sensor and print its value:</span>
  <span class="sh-comment">// int lightValue = analogRead(A0);</span>
  <span class="sh-comment">// Serial.print("Light Sensor Value: "); Serial.println(lightValue);</span>
}</code></pre>
                </li>
            </ul>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Success Criteria</h4>
            <p class="text-secondary">Your mission is a success when the central dashboard shows live, updating values
                for temperature, motion detection, and the window's open/closed status. You can even ask Google
                Assistant, "Hey Google, what's the temperature in the classroom?"</p>
            <div class="mt-8 bg-accent/10 border border-accent/30 border-l-4 border-l-accent px-6 py-4 rounded-xl">
                <h5 class="font-bold text-accent mb-2">Challenges &amp; Tips:</h5>
                <ul class="list-disc list-inside text-sm text-accent/80 space-y-2">
                    <li><b>DHT Errors:</b> Sometimes, DHT sensors can give <code>NaN</code> (Not a Number) if they fail
                        to read. Add <code>if (isnan(temp))</code> checks and skip publishing if data is bad.</li>
                    <li><b>String Concatenation:</b> Building strings like <code>"temp:22.5,motion:true"</code> can be
                        tricky. Practice using <code>String()</code> to convert numbers and booleans into text, and
                        <code>+</code> to combine them.
                    </li>
                    <li><b>Efficiency:</b> Avoid sending data too frequently. The <code>delay(1000)</code> in the main
                        loop (handled by the template's "System Engine") helps, but be mindful of how often you read and
                        publish.</li>
                </ul>
            </div>
        </div>

        <div id="station3" class="page">
            <h2 class="text-3xl font-bold text-primary border-b border-custom-border pb-3 mb-6">Station 3: Smart
                Lighting System</h2>
            <h3 class="text-xl font-bold text-primary mb-3">Your Mission: The Light Engineers</h3>
            <p class="text-secondary">You are the <b>Lighting Engineering Team</b>. Your challenge is to control two
                different lights: a powerful, multi-color RGB LED strip for the main room lighting, and a simple LED for
                an outdoor "porch light." This mission involves not just turning lights on and off, but also parsing
                complex commands from the hub to control colors and brightness!</p>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Real-World Application:</h4>
            <p class="text-secondary">This is the heart of modern smart lighting, like Philips Hue or LIFX systems!
                You're learning how to create dynamic lighting scenes, adjust ambiance, and even potentially automate
                lighting based on time of day or occupancy, contributing to energy savings and user comfort.</p>

            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Hardware Kit</h4>
            <ul class="list-disc list-inside pl-4 space-y-1">
                <li>1x ESP8266 Board</li>
                <li>1x Addressable RGB LED Strip (NeoPixel or WS2812B compatible)</li>
                <li>1x Regular LED &amp; 1x 220 Ohm Resistor (to protect the LED)</li>
            </ul>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Wiring Guide</h4>
            <p class="text-secondary mb-4">The RGB Strip (NeoPixel) requires its own external power source because it
                can draw a lot of current (ask your instructor for guidance on connecting this!). However, it receives
                its data signal from one of your ESP8266 pins. The simple LED for the porch light is powered directly
                from an ESP pin, but <i>always</i> use a resistor to limit the current and protect both the LED and your
                ESP!</p>
            <img src="https://lastminuteengineers.com/wp-content/uploads/iot/Connecting-WS2812B-Addressable-LED-Strip-to-ESP8266-5V-External-Power.png"
                alt="Wiring Diagram for Station 3 (Example for NeoPixel)"
                class="w-full rounded-2xl my-4 border border-custom-border"
                onerror="this.onerror=null; this.src='https://placehold.co/800x450/2d2e30/e8eaed?text=NeoPixel+Wiring+Diagram+Placeholder';">
            <ol class="list-decimal list-inside pl-4 space-y-2">
                <li><b>RGB Strip (NeoPixel):</b> Connect the strip's <b>Data In</b> (often labeled <code>DIN</code> or
                    <code>DI</code>) to pin <code>PIN_D4</code>. Connect the strip's 5V (positive power) and GND
                    (ground) to the separate external power supply as directed by your instructor. <b>CRITICAL:</b> You
                    MUST also connect the strip's GND to a <code>GND</code> pin on your ESP8266 to ensure both devices
                    share a common ground reference.
                </li>
                <li><b>Porch Light LED:</b> Connect the long leg (anode, positive) of the LED to one end of the
                    220&Omega; resistor. Connect the other end of the resistor to pin <code>PIN_D7</code>. Connect the
                    short leg (cathode, negative) of the LED to a <code>GND</code> pin on your ESP8266.</li>
            </ol>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Coding Mission: Step-by-Step</h4>
            <p class="text-secondary">Your station acts as an actuator&mdash;it reacts to commands. You will primarily
                write code in the <code>setupMyHardware()</code> and <code>handleMyActuatorLogic()</code> functions
                within your <code>UniversalDeviceTemplate.ino</code>. The <code>loopMySensorLogic()</code> will not be
                used by this station.</p>
            <ul class="list-disc list-inside pl-4 space-y-2">
                <li><b>Configuration &amp; Libraries:</b> Update the <code>DEVICE_NAME</code>,
                    <code>COMMAND_TOPIC</code>, and <code>STATUS_TOPIC</code>. Also, include the Adafruit NeoPixel
                    library and define your NeoPixel object and pins:
                    <pre><code><span class="sh-preprocessor">#include</span> <span class="sh-string">&lt;Adafruit_NeoPixel.h&gt;</span>

<span class="sh-keyword">const char*</span> <span class="sh-variable">DEVICE_NAME</span> = <span class="sh-string">"YourName_Lighting"</span>; <span class="sh-comment">// e.g., "Chris_Lighting"</span>
<span class="sh-keyword">const char*</span> <span class="sh-variable">COMMAND_TOPIC</span> = <span class="sh-string">"classroom/lighting/command"</span>;
<span class="sh-keyword">const char*</span> <span class="sh-variable">STATUS_TOPIC</span> = <span class="sh-string">"classroom/lighting/status"</span>;

<span class="sh-preprocessor">#define</span> <span class="sh-variable">NEOPIXEL_PIN</span> <span class="sh-variable">PIN_D4</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">NUM_PIXELS</span> <span class="sh-number">12</span> <span class="sh-comment">// Adjust based on your strip's actual length</span>

<span class="sh-class">Adafruit_NeoPixel</span> strip(NEOPIXEL_PIN, NUM_PIXELS, NEO_GRB + NEO_KHZ800);

<span class="sh-preprocessor">#define</span> <span class="sh-variable">PORCH_LIGHT_PIN</span> <span class="sh-variable">PIN_D7</span></code></pre>
                </li>
                <li><b><code>setupMyHardware()</code>:</b> Initialize the NeoPixel strip, set its initial state, and
                    configure the porch light pin.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">setupMyHardware</span>() {
  strip.<span class="sh-function">begin</span>();
  strip.<span class="sh-function">show</span>(); <span class="sh-comment">// Initialize all pixels to 'off'</span>
  strip.<span class="sh-function">setBrightness</span>(<span class="sh-number">50</span>); <span class="sh-comment">// Start with a moderate brightness</span>
  <span class="sh-function">pinMode</span>(PORCH_LIGHT_PIN, <span class="sh-literal">OUTPUT</span>);
  <span class="sh-function">digitalWrite</span>(PORCH_LIGHT_PIN, <span class="sh-literal">LOW</span>); <span class="sh-comment">// Ensure porch light starts OFF</span>

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// If you had a momentary button on PIN_D1 to test something:</span>
  <span class="sh-comment">// pinMode(PIN_D1, INPUT_PULLUP);</span>
}</code></pre>
                </li>
                <li><b><code>handleMyActuatorLogic(String command)</code>:</b> This is the core of your lighting
                    control. You'll need to parse commands for both the simple porch light and the more complex RGB
                    strip.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">handleMyActuatorLogic</span>(<span class="sh-type">String</span> <span class="sh-variable">command</span>) {
  <span class="sh-comment">// This function runs when a command is received.</span>
  <span class="sh-comment">// Handle Porch Light commands (simple ON/OFF).</span>
  <span class="sh-keyword">if</span> (<span class="sh-variable">command</span> == <span class="sh-string">"PORCH_ON"</span>) {
    digitalWrite(PORCH_LIGHT_PIN, HIGH);
    myDevice.publishTo("classroom/lighting/porch_status", "ON");
  } <span class="sh-keyword">else if</span> (<span class="sh-variable">command</span> == <span class="sh-string">"PORCH_OFF"</span>) {
    digitalWrite(PORCH_LIGHT_PIN, LOW);
    myDevice.publishTo("classroom/lighting/porch_status", "OFF");
  } 
  <span class="sh-comment">// Handle Main RGB Strip commands (e.g., "SWITCH=ON,BRIGHTNESS=50,COLOR=#FF0000").</span>
  <span class="sh-keyword">else if</span> (<span class="sh-variable">command</span>.<span class="sh-function">startsWith</span>(<span class="sh-string">"SWITCH="</span>)) {
    <span class="sh-keyword">if</span> (<span class="sh-variable">command</span>.<span class="sh-function">indexOf</span>(<span class="sh-string">"SWITCH=OFF"</span>) <span class="sh-operator">!=</span> <span class="sh-number">-1</span>) {
      strip.clear();
      strip.show();
      myDevice.publishTo(STATUS_TOPIC, "OFF");
    } <span class="sh-keyword">else</span> {
      <span class="sh-comment">// Parse BRIGHTNESS and COLOR from the command string</span>
      <span class="sh-type">int</span> brightness = 255; // Default brightness
      <span class="sh-type">String</span> colorHex = "#FFFFFF"; // Default color (white)

      <span class="sh-type">int</span> brightnessIndex = command.indexOf("BRIGHTNESS=");
      <span class="sh-type">int</span> colorIndex = command.indexOf("COLOR=");

      if (brightnessIndex != -1) {
          <span class="sh-type">int</span> endIndex = command.indexOf(",", brightnessIndex);
          if (endIndex == -1) endIndex = command.length();
          <span class="sh-type">String</span> brightnessStr = command.substring(brightnessIndex + 11, endIndex);
          brightness = brightnessStr.toInt();
          strip.setBrightness(brightness);
      }

      if (colorIndex != -1) {
          <span class="sh-type">int</span> endIndex = command.indexOf(",", colorIndex);
          if (endIndex == -1) endIndex = command.length();
          colorHex = command.substring(colorIndex + 6, endIndex);
          
          <span class="sh-type">long</span> colorValue = strtol(colorHex.substring(1).c_str(), NULL, 16);
          <span class="sh-type">uint8_t</span> r = (colorValue >> 16) & 0xFF;
          <span class="sh-type">uint8_t</span> g = (colorValue >> 8) & 0xFF;
          <span class="sh-type">uint8_t</span> b = colorValue & 0xFF;
          
          <span class="sh-comment">// Set all pixels to the new color</span>
          for(int i=0; i<NUM_PIXELS; i++) {
            strip.setPixelColor(i, strip.Color(r, g, b));
          }
      }
      strip.show();
      myDevice.publishTo(STATUS_TOPIC, "ON");
    }
  }

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// If you had a simple toggle LED on PIN_D5 for a test:</span>
  <span class="sh-comment">// if (command == "TEST_TOGGLE") {</span>
  <span class="sh-comment">//   digitalWrite(PIN_D5, !digitalRead(PIN_D5)); // Toggles the LED state</span>
  <span class="sh-comment">//   myDevice.publishTo("classroom/test/status", digitalRead(PIN_D5) ? "ON" : "OFF");</span>
  <span class="sh-comment">// }</span>
}</code></pre>
                </li>
            </ul>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Success Criteria</h4>
            <p class="text-secondary">You've succeeded when you can ask Google Assistant to change the main room light's
                color (e.g., "turn main light blue"), adjust its brightness, and separately turn the porch light on and
                off, with all commands responding reliably!</p>
            <div class="mt-8 bg-accent/10 border border-accent/30 border-l-4 border-l-accent px-6 py-4 rounded-xl">
                <h5 class="font-bold text-accent mb-2">Challenges &amp; Tips:</h5>
                <ul class="list-disc list-inside text-sm text-accent/80 space-y-2">
                    <li><b>String Handling Practice:</b> Take your time with <code>indexOf()</code> and
                        <code>substring()</code>. They are powerful but can be tricky if not used carefully. Print
                        intermediate results to <code>Serial Monitor</code> to see what your strings look like at each
                        step.
                    </li>
                    <li><b>Powering NeoPixels:</b> If your NeoPixels behave erratically or show wrong colors, it's often
                        a power issue. Ensure your external power supply is sufficient and grounds are properly
                        connected.</li>
                    <li><b><code>strtol()</code> Explained:</b> <code>strtol(hexString.c_str(), NULL, 16)</code>
                        converts a character string (<code>hexString.c_str()</code>) to a <code>long</code> integer,
                        using base 16 (hexadecimal). The <code>NULL</code> part is for error checking, which we can skip
                        for camp purposes.</li>
                </ul>
            </div>
        </div>

        <div id="station4" class="page">
            <h2 class="text-3xl font-bold text-primary border-b border-custom-border pb-3 mb-6">Station 4: Smart Door
                Security</h2>
            <h3 class="text-xl font-bold text-primary mb-3">Your Mission: Guardians of the Gateway</h3>
            <p class="text-secondary">You are the <b>Security &amp; Access Team</b>. Your critical mission is to build a
                complete smart door system. You'll use a servo motor as the lock mechanism and a magnetic contact switch
                to detect if the door is open or closed. You must constantly report the complete status of both the door
                (open/closed) and the lock (locked/unlocked) to the central hub.</p>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Real-World Application:</h4>
            <p class="text-secondary">This is exactly how smart locks (like August or Yale Smart Lock) work! You're
                building the core components of a sophisticated access control system that can be remotely managed and
                provide real-time security alerts. Imagine integrating this with security cameras or smart alarms!</p>

            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Hardware Kit</h4>
            <ul class="list-disc list-inside pl-4 space-y-1">
                <li>1x ESP8266 Board</li>
                <li>1x Servo Motor (e.g., SG90 or similar, often miniature)</li>
                <li>1x Magnetic Contact Switch</li>
            </ul>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Wiring Guide</h4>
            <p class="text-secondary mb-4">Servos can draw more power than a digital pin can directly supply, so we
                power them from the <code>VIN</code> pin on your ESP8266 board, which provides a steady 5V directly from
                the USB connection. The magnetic contact switch works just like the one in Station 2, using the ESP's
                internal pull-up resistor.</p>
            <img src="https://hackster.imgix.net/uploads/attachments/1112773/image_mYrTQym88w.png?auto=compress%2Cformat&w=1280&h=960&fit=max"
                alt="Wiring Diagram for Station 4 (Example for Servo)"
                class="w-full rounded-2xl my-4 border border-custom-border"
                onerror="this.onerror=null; this.src='https://placehold.co/800x450/2d2e30/e8eaed?text=Servo+Wiring+Diagram+Placeholder';">
            <ol class="list-decimal list-inside pl-4 space-y-2">
                <li><b>Servo (Lock Mechanism):</b> Connect its <b>Power</b> (red wire, usually) to the <code>VIN</code>
                    pin on your ESP8266. Connect its <b>Ground</b> (brown/black wire) to a <code>GND</code> pin. Connect
                    its <b>Signal</b> (orange/yellow wire) to <code>PIN_D6</code>.</li>
                <li><b>Door Sensor (Magnetic Contact Switch):</b> Connect one wire of the switch to <code>PIN_D1</code>
                    and the other wire to <code>GND</code>. We will configure this pin with <code>INPUT_PULLUP</code>
                    mode in your code.</li>
            </ol>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Coding Mission: Step-by-Step</h4>
            <p class="text-secondary">Your station acts as both an actuator (lock) and a sensor (door state). You will
                primarily write code in the <code>setupMyHardware()</code>, <code>loopMySensorLogic()</code> and
                <code>handleMyActuatorLogic()</code> functions within your <code>UniversalDeviceTemplate.ino</code>.
            </p>
            <ul class="list-disc list-inside pl-4 space-y-2">
                <li><b>Configuration &amp; Libraries:</b> Update the <code>DEVICE_NAME</code>,
                    <code>COMMAND_TOPIC</code>, and <code>STATUS_TOPIC</code>. Also, include the Servo library, define
                    your servo object and pins, and declare a global variable to track the lock state:
                    <pre><code><span class="sh-preprocessor">#include</span> <span class="sh-string">&lt;Servo.h&gt;</span>

<span class="sh-keyword">const char*</span> <span class="sh-variable">DEVICE_NAME</span> = <span class="sh-string">"YourName_Door"</span>; <span class="sh-comment">// e.g., "Emily_Door"</span>
<span class="sh-keyword">const char*</span> <span class="sh-variable">COMMAND_TOPIC</span> = <span class="sh-string">"classroom/door/command"</span>;
<span class="sh-keyword">const char*</span> <span class="sh-variable">STATUS_TOPIC</span> = <span class="sh-string">"classroom/door/status"</span>;

<span class="sh-class">Servo</span> myServo;
<span class="sh-preprocessor">#define</span> <span class="sh-variable">SERVO_PIN</span> <span class="sh-variable">PIN_D6</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">DOOR_SENSOR_PIN</span> <span class="sh-variable">PIN_D1</span>

<span class="sh-type">bool</span> isLocked = <span class="sh-literal">false</span>; <span class="sh-comment">// Global variable to track the current lock state</span></code></pre>
                </li>
                <li><b><code>setupMyHardware()</code>:</b> Initialize your servo and set the pin mode for the door
                    sensor.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">setupMyHardware</span>() {
  myServo.<span class="sh-function">attach</span>(SERVO_PIN);
  myServo.<span class="sh-function">write</span>(<span class="sh-number">0</span>); <span class="sh-comment">// Set initial position (e.g., unlocked), adjust as needed for your mechanism</span>
  isLocked = <span class="sh-literal">false</span>; <span class="sh-comment">// Reflect initial unlocked state</span>
  <span class="sh-function">pinMode</span>(DOOR_SENSOR_PIN, <span class="sh-literal">INPUT_PULLUP</span>);

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// If you had a light sensor, you might:</span>
  <span class="sh-comment">// Serial.println("Light sensor initialized!");</span>
}</code></pre>
                </li>
                <li><b><code>handleMyActuatorLogic(String command)</code>:</b> This function will receive
                    <code>"LOCK"</code> and <code>"UNLOCK"</code> commands. You'll move the servo and update your global
                    <code>isLocked</code> variable.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">handleMyActuatorLogic</span>(<span class="sh-type">String</span> <span class="sh-variable">command</span>) {
  <span class="sh-comment">// This function runs when a command is received for the door.</span>
  <span class="sh-comment">// Move the servo to the correct angle based on the command.</span>
  <span class="sh-comment">// Update the global 'isLocked' variable to reflect the new state.</span>
  <span class="sh-keyword">if</span> (<span class="sh-variable">command</span> == <span class="sh-string">"LOCK"</span>) {
    myServo.<span class="sh-function">write</span>(<span class="sh-number">90</span>); <span class="sh-comment">// Example angle for locked, adjust for your servo/lock setup</span>
    isLocked = <span class="sh-literal">true</span>;
    Serial.<span class="sh-function">println</span>(<span class="sh-string">"Door Locked."</span>);
  } <span class="sh-keyword">else if</span> (<span class="sh-variable">command</span> == <span class="sh-string">"UNLOCK"</span>) {
    myServo.<span class="sh-function">write</span>(<span class="sh-number">0</span>); <span class="sh-comment">// Example angle for unlocked, adjust for your servo/lock setup</span>
    isLocked = <span class="sh-literal">false</span>;
    Serial.<span class="sh-function">println</span>(<span class="sh-string">"Door Unlocked."</span>);
  }

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// If a command changed a variable:</span>
  <span class="sh-comment">// if (command == "RESET_COUNT") { sensorCount = 0; }</span>
}</code></pre>
                </li>
                <li><b><code>loopMySensorLogic()</code>:</b> This is where you'll continuously read the door sensor and
                    combine its state with the lock's state (from <code>isLocked</code>) into a single status string,
                    then publish it.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">loopMySensorLogic</span>() {
  <span class="sh-comment">// This function runs repeatedly to monitor the door sensor and publish status.</span>
  <span class="sh-comment">// Read the magnetic contact switch. LOW means the switch is closed (door closed).</span>
  <span class="sh-type">bool</span> doorIsClosed = (<span class="sh-function">digitalRead</span>(DOOR_SENSOR_PIN) <span class="sh-operator">==</span> <span class="sh-literal">LOW</span>);

  <span class="sh-comment">// Determine the string representation for door and lock states.</span>
  <span class="sh-type">String</span> doorStatus = doorIsClosed <span class="sh-operator">?</span> <span class="sh-string">"CLOSED"</span> <span class="sh-operator">:</span> <span class="sh-string">"OPEN"</span>;
  <span class="sh-type">String</span> lockStatus = isLocked <span class="sh-operator">?</span> <span class="sh-string">"LOCKED"</span> <span class="sh-operator">:</span> <span class="sh-string">"UNLOCKED"</span>;

  <span class="sh-comment">// Combine into the required format: "DOOR_STATE,LOCK_STATE".</span>
  <span class="sh-type">String</span> payload = doorStatus <span class="sh-operator">+</span> <span class="sh-string">","</span> <span class="sh-operator">+</span> lockStatus; 
  myDevice.<span class="sh-function">publishTo</span>(STATUS_TOPIC, payload); <span class="sh-comment">// Publish to "classroom/door/status".</span>
  Serial.<span class="sh-function">print</span>(<span class="sh-string">"Door status sent: "</span>); Serial.<span class="sh-function">println</span>(payload);
}</code></pre>
                </li>
            </ul>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Success Criteria</h4>
            <p class="text-secondary">You succeed when the central dashboard correctly shows the door's state (e.g.,
                "CLOSED,LOCKED" or "OPEN,UNLOCKED") in real-time, and you can reliably lock and unlock the door using
                voice commands via Google Assistant!</p>
            <div class="mt-8 bg-accent/10 border border-accent/30 border-l-4 border-l-accent px-6 py-4 rounded-xl">
                <h5 class="font-bold text-accent mb-2">Challenges &amp; Tips:</h5>
                <ul class="list-disc list-inside text-sm text-accent/80 space-y-2">
                    <li><b>Servo Angles:</b> Experiment with <code>myServo.write(angle);</code> to find the precise
                        angles that fully lock and unlock your physical mechanism. Servos operate between 0 and 180
                        degrees.</li>
                    <li><b>Power for Servo:</b> If your servo jitters or doesn't move smoothly, it might not be getting
                        enough power. The <code>VIN</code> pin is usually good, but large servos might need a dedicated
                        external power supply (ask instructor if needed).</li>
                </ul>
            </div>
        </div>

        <div id="station5" class="page">
            <h2 class="text-3xl font-bold text-primary border-b border-custom-border pb-3 mb-6">Station 5: Automated
                Curtain</h2>
            <h3 class="text-xl font-bold text-primary mb-3">Your Mission: The Mechatronics Maestros</h3>
            <p class="text-secondary">You are the <b>Mechatronics Team</b>. This is a low-level control challenge that
                combines mechanical movement with smart logic! You'll program the intelligence for a motorized smart
                curtain. You will use a continuous rotation servo as the motor and two limit switches to detect when the
                curtain is fully open or fully closed. This mission requires understanding and implementing a "state
                machine" to ensure smooth and reliable operation!</p>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Real-World Application:</h4>
            <p class="text-secondary">Think about automated window shades in smart homes or offices that can adjust
                based on sunlight, time of day, or privacy needs. You're building the core control system for such
                convenience, integrating mechanical components with intelligent software.</p>

            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Hardware Kit</h4>
            <ul class="list-disc list-inside pl-4 space-y-1">
                <li>1x ESP8266 Board</li>
                <li>1x Continuous Rotation Servo (often used as a winch motor for curtains)</li>
                <li>2x Limit Switches (one for "fully open", one for "fully closed")</li>
            </ul>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Wiring Guide</h4>
            <p class="text-secondary mb-4">A continuous rotation servo is wired just like a standard servo, but instead
                of controlling an angle, it controls speed and direction. The limit switches are simple push buttons
                that will be physically triggered when the curtain reaches its fully open or closed position.</p>
            <img src="https://hackster.imgix.net/uploads/attachments/1112773/image_mYrTQym88w.png?auto=compress%2Cformat&w=1280&h=960&fit=max"
                alt="Wiring Diagram for Station 5 (Example for Servo &amp; Switches)"
                class="w-full rounded-2xl my-4 border border-custom-border"
                onerror="this.onerror=null; this.src='https://placehold.co/800x450/2d2e30/e8eaed?text=Servo+Switch+Wiring+Diagram+Placeholder';">
            <ol class="list-decimal list-inside pl-4 space-y-2">
                <li><b>Continuous Rotation Servo:</b> Connect its <b>Power</b> (red wire) to <code>VIN</code> (5V from
                    USB), its <b>Ground</b> (black/brown wire) to <code>GND</code>, and its <b>Signal</b> (yellow/orange
                    wire) to <code>PIN_D6</code>.</li>
                <li><b>Limit Switches:</b> Connect one leg of each switch to <code>GND</code>. Connect the other leg of
                    the "Top" (fully open) switch to <code>PIN_D1</code> and the "Bottom" (fully closed) switch to
                    <code>PIN_D2</code>. Both these pins will use <code>INPUT_PULLUP</code> mode.
                </li>
            </ol>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Coding Mission: Step-by-Step</h4>
            <p class="text-secondary">This station involves controlling a motor and reading sensors to manage the
                curtain's movement. You will primarily write code in the <code>setupMyHardware()</code>,
                <code>loopMySensorLogic()</code> and <code>handleMyActuatorLogic()</code> functions within your
                <code>UniversalDeviceTemplate.ino</code>.
            </p>
            <ul class="list-disc list-inside pl-4 space-y-2">
                <li><b>Configuration &amp; Libraries:</b> Update the <code>DEVICE_NAME</code>,
                    <code>COMMAND_TOPIC</code>, and <code>STATUS_TOPIC</code>. Also, include the Servo library, define
                    your servo object and pins, and declare a global variable for the curtain's state machine:
                    <pre><code><span class="sh-preprocessor">#include</span> <span class="sh-string">&lt;Servo.h&gt;</span>

<span class="sh-keyword">const char*</span> <span class="sh-variable">DEVICE_NAME</span> = <span class="sh-string">"YourName_Curtain"</span>; <span class="sh-comment">// e.g., "Omar_Curtain"</span>
<span class="sh-keyword">const char*</span> <span class="sh-variable">COMMAND_TOPIC</span> = <span class="sh-string">"classroom/curtain/command"</span>;
<span class="sh-keyword">const char*</span> <span class="sh-variable">STATUS_TOPIC</span> = <span class="sh-string">"classroom/curtain/status"</span>;

<span class="sh-class">Servo</span> myCurtainMotor;
<span class="sh-preprocessor">#define</span> <span class="sh-variable">SERVO_PIN</span> <span class="sh-variable">PIN_D6</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">TOP_SWITCH_PIN</span> <span class="sh-variable">PIN_D1</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">BOTTOM_SWITCH_PIN</span> <span class="sh-variable">PIN_D2</span>

<span class="sh-type">String</span> curtainAction = <span class="sh-string">"STOPPED"</span>; <span class="sh-comment">// Global variable to manage the curtain's state: "OPENING", "CLOSING", "STOPPED"</span></code></pre>
                </li>
                <li><b><code>setupMyHardware()</code>:</b> Initialize your continuous rotation servo and set the pin
                    modes for the limit switches.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">setupMyHardware</span>() {
  myCurtainMotor.<span class="sh-function">attach</span>(SERVO_PIN);
  myCurtainMotor.<span class="sh-function">write</span>(<span class="sh-number">90</span>); <span class="sh-comment">// Stop the continuous rotation servo initially (90 is usually stop, may need calibration)</span>
  <span class="sh-function">pinMode</span>(TOP_SWITCH_PIN, <span class="sh-literal">INPUT_PULLUP</span>);
  <span class="sh-function">pinMode</span>(BOTTOM_SWITCH_PIN, <span class="sh-literal">INPUT_PULLUP</span>);

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// To blink an LED on PIN_D5 for testing setup:</span>
  <span class="sh-comment">// pinMode(PIN_D5, OUTPUT);</span>
  <span class="sh-comment">// for(int i=0; i<3; i++) { digitalWrite(PIN_D5, HIGH); delay(100); digitalWrite(PIN_D5, LOW); delay(100); }</span>
}</code></pre>
                </li>
                <li><b><code>handleMyActuatorLogic(String command)</code>:</b> This function will <i>only</i> change the
                    global <code>curtainAction</code> state variable based on incoming commands. It does <i>not</i>
                    directly control the motor.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">handleMyActuatorLogic</span>(<span class="sh-type">String</span> <span class="sh-variable">command</span>) {
  <span class="sh-comment">// This function processes commands for the curtain (e.g., "OPEN", "CLOSE", "STOP").</span>
  <span class="sh-comment">// Its primary job is to update the global 'curtainAction' variable.</span>
  <span class="sh-keyword">if</span> (<span class="sh-variable">command</span> == <span class="sh-string">"OPEN"</span>) {
    curtainAction = <span class="sh-string">"OPENING"</span>;
    Serial.<span class="sh-function">println</span>(<span class="sh-string">"Command: Set state to OPENING"</span>);
  } <span class="sh-keyword">else if</span> (<span class="sh-variable">command</span> == <span class="sh-string">"CLOSE"</span>) {
    curtainAction = <span class="sh-string">"CLOSING"</span>;
    Serial.<span class="sh-function">println</span>(<span class="sh-string">"Command: Set state to CLOSING"</span>);
  } <span class="sh-keyword">else if</span> (<span class="sh-variable">command</span> == <span class="sh-string">"STOP"</span>) {
    curtainAction = <span class="sh-string">"STOPPED"</span>;
    <span class="sh-comment">// You might explicitly stop the motor here too for immediate response.</span>
    myCurtainMotor.<span class="sh-function">write</span>(<span class="sh-number">90</span>); 
    myDevice.<span class="sh-function">publishTo</span>(STATUS_TOPIC, <span class="sh-string">"STOPPED"</span>);
    Serial.<span class="sh-function">println</span>(<span class="sh-string">"Command: Set state to STOPPED"</span>);
  }

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// If you had a sound output:</span>
  <span class="sh-comment">// if (command == "PLAY_SOUND") { tone(PIN_D7, 1000, 200); }</span>
}</code></pre>
                </li>
                <li><b><code>loopMySensorLogic()</code>:</b> This is where the state machine logic lives. It will
                    continuously check the <code>curtainAction</code> variable and the limit switches to control the
                    motor and publish status updates.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">loopMySensorLogic</span>() {
  <span class="sh-comment">// This function constantly checks the curtain's state and controls the motor.</span>
  <span class="sh-comment">// Read the state of the top and bottom limit switches.</span>
  <span class="sh-comment">// Remember, LOW means the switch is pressed when using INPUT_PULLUP.</span>
  <span class="sh-type">bool</span> topSwitchPressed = (<span class="sh-function">digitalRead</span>(TOP_SWITCH_PIN) <span class="sh-operator">==</span> <span class="sh-literal">LOW</span>);
  <span class="sh-type">bool</span> bottomSwitchPressed = (<span class="sh-function">digitalRead</span>(BOTTOM_SWITCH_PIN) <span class="sh-operator">==</span> <span class="sh-literal">LOW</span>);

  <span class="sh-comment">// Implement your state machine logic here:</span>
  <span class="sh-keyword">if</span> (curtainAction == <span class="sh-string">"OPENING"</span>) {
    <span class="sh-comment">// If opening and top switch is pressed, stop the motor and set state to STOPPED/OPEN.</span>
    <span class="sh-keyword">if</span> (topSwitchPressed) {
      curtainAction = <span class="sh-string">"STOPPED"</span>;
      myCurtainMotor.<span class="sh-function">write</span>(<span class="sh-number">90</span>); <span class="sh-comment">// Stop the servo</span>
      myDevice.<span class="sh-function">publishTo</span>(STATUS_TOPIC, <span class="sh-string">"OPEN"</span>); <span class="sh-comment">// Report fully OPEN status</span>
      Serial.<span class="sh-function">println</span>(<span class="sh-string">"Curtain is OPEN."</span>);
    } <span class="sh-keyword">else</span> {
      <span class="sh-comment">// Otherwise, keep running the motor to open the curtain.</span>
      myCurtainMotor.<span class="sh-function">write</span>(<span class="sh-number">180</span>); <span class="sh-comment">// Run continuous servo one direction to open (adjust value for speed/direction)</span>
    }
  } <span class="sh-keyword">else if</span> (curtainAction == <span class="sh-string">"CLOSING"</span>) {
    <span class="sh-comment">// If closing and bottom switch is pressed, stop the motor and set state to STOPPED/CLOSED.</span>
    <span class="sh-keyword">if</span> (bottomSwitchPressed) {
      curtainAction = <span class="sh-string">"STOPPED"</span>;
      myCurtainMotor.<span class="sh-function">write</span>(<span class="sh-number">90</span>); <span class="sh-comment">// Stop the servo</span>
      myDevice.<span class="sh-function">publishTo</span>(STATUS_TOPIC, <span class="sh-string">"CLOSED"</span>); <span class="sh-comment">// Report fully CLOSED status</span>
      Serial.<span class="sh-function">println</span>(<span class="sh-string">"Curtain is CLOSED."</span>);
    } <span class="sh-keyword">else</span> {
      <span class="sh-comment">// Otherwise, keep running the motor to close the curtain.</span>
      myCurtainMotor.<span class="sh-function">write</span>(<span class="sh-number">0</span>); <span class="sh-comment">// Run continuous servo other direction to close (adjust value)</span>
    }
  } <span class="sh-keyword">else</span> { <span class="sh-comment">// Action is "STOPPED" or initial state</span>
    myCurtainMotor.<span class="sh-function">write</span>(<span class="sh-number">90</span>); <span class="sh-comment">// Ensure the continuous servo is stopped when no action is needed.</span>
  }

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// If you were reading a potentiometer:</span>
  <span class="sh-comment">// int potValue = analogRead(A0);</span>
  <span class="sh-comment">// Serial.print("Potentiometer value: "); Serial.println(potValue);</span>
}</code></pre>
                </li>
            </ul>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Success Criteria</h4>
            <p class="text-secondary">Success is when the curtain opens and closes fully via voice commands, stopping
                automatically and reliably when it hits the respective limit switches (both top and bottom). The central
                dashboard should also accurately reflect the curtain's state as "OPEN" or "CLOSED" when it reaches an
                end point, or "STOPPED" if you manually stop it.</p>
            <div class="mt-8 bg-accent/10 border border-accent/30 border-l-4 border-l-accent px-6 py-4 rounded-xl">
                <h5 class="font-bold text-accent mb-2">Challenges &amp; Tips:</h5>
                <ul class="list-disc list-inside text-sm text-accent/80 space-y-2">
                    <li><b>Continuous Servo Calibration:</b> The "stop" value for a continuous servo isn't always
                        exactly <code>90</code>. You might need to experiment (e.g., try <code>88</code> or
                        <code>92</code>) to find the value where your motor truly stops spinning.
                    </li>
                    <li><b>Robustness:</b> What happens if a limit switch fails? How can you add a timeout to prevent
                        the motor from running indefinitely? (These are advanced questions for later!)</li>
                    <li><b>Debugging States:</b> Print the <code>curtainAction</code> variable to your
                        <code>Serial Monitor</code> in the <code>loop()</code> to observe how your state machine is
                        transitioning. This is a powerful debugging technique.
                    </li>
                </ul>
            </div>
        </div>

        <div id="station6" class="page">
            <h2 class="text-3xl font-bold text-primary border-b border-custom-border pb-3 mb-6">Station 6: Master
                Control Panel</h2>
            <h3 class="text-xl font-bold text-primary mb-3">Your Mission: The System Integrators</h3>
            <p class="text-secondary">You are the <b>System Integration Team</b>. You have the most complex and exciting
                task: building the master physical controller for the entire Smart Classroom! You will program four push
                buttons, each designed to toggle the state of another specific device in the room (like the HVAC,
                lights, or door). Crucially, your panel's LEDs must always show the <i>real</i>, live state of those
                other devices, making your panel a true command and feedback center.</p>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Real-World Application:</h4>
            <p class="text-secondary">You're building the physical equivalent of a smart home hub or a building
                management system dashboard! This is how users interact directly with complex IoT setups, providing a
                tangible interface that reflects the system's current status and allows for immediate control. This
                involves deep understanding of how different smart devices communicate.</p>

            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Hardware Kit</h4>
            <ul class="list-disc list-inside pl-4 space-y-1">
                <li>1x ESP8266 Board</li>
                <li>1x Pre-wired Panel with 4 Push Buttons</li>
                <li>1x 4-channel Relay Module (to control the panel's indicator LEDs)</li>
            </ul>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Wiring Guide</h4>
            <p class="text-secondary mb-4">This station is largely pre-wired for convenience, but it's important to
                understand the connections so you can use the correct pins in your code. The buttons are connected as
                inputs, and the relay module controls the indicator LEDs on your panel.</p>
            <img src="https://diyables.io/images/products/button-esp8266.jpg"
                alt="Wiring Diagram for Station 6 (Example for Buttons)"
                class="w-full rounded-2xl my-4 border border-custom-border"
                onerror="this.onerror=null; this.src='https://placehold.co/800x450/2d2e30/e8eaed?text=Button+Wiring+Diagram+Placeholder';">
            <ul class="list-disc list-inside pl-4 space-y-2">
                <li><b>Buttons:</b> These are typically wired to pins like <code>PIN_D1, PIN_D2, PIN_D5, PIN_D6</code>.
                    They will be configured with <code>INPUT_PULLUP</code> mode, meaning they read <code>LOW</code> when
                    pressed. Your instructor will confirm exact pin assignments.</li>
                <li><b>Relays (for LEDs):</b> The input pins of the 4-channel relay module that control your panel's
                    indicator LEDs will be wired to other digital output pins on your ESP8266. Your instructor will
                    confirm the exact pins.</li>
            </ul>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Coding Mission: Step-by-Step</h4>
            <p class="text-secondary">Your mission is to integrate multiple devices. This station is unique as it will
                heavily utilize the advanced <code>SmartDevice</code> functions. You will primarily write code in the
                <code>setupMyHardware()</code> and <code>loopMySensorLogic()</code> functions. You will also create a
                custom <code>handlePanelMessages()</code> function that will be registered with
                <code>onMessage()</code>.
            </p>
            <ul class="list-disc list-inside pl-4 space-y-2">
                <li><b>Configuration &amp; Global Variables:</b> Update the <code>DEVICE_NAME</code>. You will create
                    many global variables to track the state of other devices and define your button and LED pins. Also,
                    add a forward declaration for your custom message handler.
                    <pre><code><span class="sh-keyword">const char*</span> <span class="sh-variable">DEVICE_NAME</span> = <span class="sh-string">"YourName_ControlPanel"</span>; <span class="sh-comment">// e.g., "Sarah_Panel"</span>
<span class="sh-comment">// COMMAND_TOPIC and STATUS_TOPIC are less relevant here as you're controlling/listening to multiple topics.</span>
<span class="sh-keyword">const char*</span> <span class="sh-variable">COMMAND_TOPIC</span> = <span class="sh-string">"classroom/panel/command"</span>; 
<span class="sh-keyword">const char*</span> <span class="sh-variable">STATUS_TOPIC</span> = <span class="sh-string">"classroom/panel/status"</span>; 

<span class="sh-comment">// Global state variables for other devices (initialize to false/off)</span>
<span class="sh-type">bool</span> isHvacOn = <span class="sh-literal">false</span>;
<span class="sh-type">bool</span> isKettleOn = <span class="sh-literal">false</span>;
<span class="sh-type">bool</span> isMainLightOn = <span class="sh-literal">false</span>;
<span class="sh-type">bool</span> isPorchLightOn = <span class="sh-literal">false</span>;
<span class="sh-type">bool</span> isDoorLocked = <span class="sh-literal">false</span>;
<span class="sh-type">bool</span> isCurtainOpen = <span class="sh-literal">false</span>;

<span class="sh-comment">// Define your button and LED pins here (confirm with instructor)</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">BUTTON_HVAC_PIN</span> <span class="sh-variable">PIN_D1</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">BUTTON_LIGHT_PIN</span> <span class="sh-variable">PIN_D2</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">BUTTON_DOOR_PIN</span> <span class="sh-variable">PIN_D5</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">BUTTON_CURTAIN_PIN</span> <span class="sh-variable">PIN_D6</span>

<span class="sh-preprocessor">#define</span> <span class="sh-variable">LED_HVAC_PIN</span> <span class="sh-variable">PIN_D7</span> <span class="sh-comment">// Example pin for HVAC status LED</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">LED_LIGHT_PIN</span> <span class="sh-number">15</span> <span class="sh-comment">// Example for another available pin, e.g. D8 (GPIO15)</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">LED_DOOR_PIN</span> <span class="sh-number">0</span>  <span class="sh-comment">// Example for another available pin, e.g. D3 (GPIO0)</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">LED_CURTAIN_PIN</span> <span class="sh-number">2</span> <span class="sh-comment">// Example for another available pin, e.g. D4 (GPIO2)</span>

<span class="sh-comment">// Forward declaration for the advanced message handler.</span>
<span class="sh-keyword">void</span> handlePanelMessages(<span class="sh-type">String</span> topic, <span class="sh-type">String</span> payload);</code></pre>
                </li>
                <li><b><code>setupMyHardware()</code>:</b> Set up your button inputs and LED outputs. Crucially,
                    subscribe to all the status topics you need to listen to from other devices, and register your
                    custom <code>handlePanelMessages()</code> function with <code>myDevice.onMessage()</code>.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">setupMyHardware</span>() {
  <span class="sh-comment">// Set up button pins as INPUT_PULLUP.</span>
  <span class="sh-function">pinMode</span>(BUTTON_HVAC_PIN, <span class="sh-literal">INPUT_PULLUP</span>);
  <span class="sh-function">pinMode</span>(BUTTON_LIGHT_PIN, <span class="sh-literal">INPUT_PULLUP</span>);
  <span class="sh-function">pinMode</span>(BUTTON_DOOR_PIN, <span class="sh-literal">INPUT_PULLUP</span>);
  <span class="sh-function">pinMode</span>(BUTTON_CURTAIN_PIN, <span class="sh-literal">INPUT_PULLUP</span>);

  <span class="sh-comment">// Set up LED pins as OUTPUT and ensure they are initially OFF.</span>
  <span class="sh-function">digitalWrite</span>(LED_HVAC_PIN, <span class="sh-literal">LOW</span>);
  <span class="sh-function">digitalWrite</span>(LED_LIGHT_PIN, <span class="sh-literal">LOW</span>);
  <span class="sh-function">digitalWrite</span>(LED_DOOR_PIN, <span class="sh-literal">LOW</span>);
  <span class="sh-function">digitalWrite</span>(LED_CURTAIN_PIN, <span class="sh-literal">LOW</span>);
  <span class="sh-function">pinMode</span>(LED_HVAC_PIN, <span class="sh-literal">OUTPUT</span>); 
  <span class="sh-function">pinMode</span>(LED_LIGHT_PIN, <span class="sh-literal">OUTPUT</span>); 
  <span class="sh-function">pinMode</span>(LED_DOOR_PIN, <span class="sh-literal">OUTPUT</span>); 
  <span class="sh-function">pinMode</span>(LED_CURTAIN_PIN, <span class="sh-literal">OUTPUT</span>); 

  <span class="sh-comment">// Subscribe to status topics of other devices using myDevice.subscribeTo().</span>
  <span class="sh-comment">// Example: Subscribe to HVAC status, Kettle status, Main Lighting status, etc.</span>
  myDevice.<span class="sh-function">subscribeTo</span>(<span class="sh-string">"classroom/hvac/status"</span>);
  myDevice.<span class="sh-function">subscribeTo</span>(<span class="sh-string">"classroom/hvac/kettle_status"</span>);
  myDevice.<span class="sh-function">subscribeTo</span>(<span class="sh-string">"classroom/lighting/status"</span>);
  myDevice.<span class="sh-function">subscribeTo</span>(<span class="sh-string">"classroom/lighting/porch_status"</span>);
  myDevice.<span class="sh-function">subscribeTo</span>(<span class="sh-string">"classroom/door/status"</span>);
  myDevice.<span class="sh-function">subscribeTo</span>(<span class="sh-string">"classroom/curtain/status"</span>);

  <span class="sh-comment">// Register your custom advanced message handler. This OVERRIDES the default.</span>
  myDevice.<span class="sh-function">onMessage</span>(handlePanelMessages);

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// To initialize an OLED display connected to I2C:</span>
  <span class="sh-comment">// display.begin(SSD1306_SWITCHCAPVCC, 0x3C);</span>
  <span class="sh-comment">// display.display();</span>
}</code></pre>
                </li>
                <li><b><code>handlePanelMessages(String topic, String payload)</code>:</b> Create this function. It will
                    be called every time any message is received on any topic your panel is subscribed to. Use
                    <code>if/else if</code> statements to determine which device sent the message and update your global
                    state variables and corresponding LEDs.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">handlePanelMessages</span>(<span class="sh-type">String</span> <span class="sh-variable">topic</span>, <span class="sh-type">String</span> <span class="sh-variable">payload</span>) {
  Serial.<span class="sh-function">printf</span>(<span class="sh-string">"Panel Rx: Topic: %s, Payload: %s\\n"</span>, <span class="sh-variable">topic</span>.<span class="sh-function">c_str</span>(), <span class="sh-variable">payload</span>.<span class="sh-function">c_str</span>());

  <span class="sh-comment">// Use if/else if to update global state variables and LEDs based on the 'topic' and 'payload'.</span>
  <span class="sh-comment">// Example: Update HVAC status LED.</span>
  <span class="sh-keyword">if</span> (<span class="sh-variable">topic</span> == <span class="sh-string">"classroom/hvac/status"</span>) {
    isHvacOn = (<span class="sh-variable">payload</span> == <span class="sh-string">"ON"</span>);
    <span class="sh-function">digitalWrite</span>(LED_HVAC_PIN, isHvacOn <span class="sh-operator">?</span> <span class="sh-literal">HIGH</span> <span class="sh-operator">:</span> <span class="sh-literal">LOW</span>);
  } 
  <span class="sh-comment">// Example: Update Kettle status LED.</span>
  <span class="sh-keyword">else if</span> (<span class="sh-variable">topic</span> == <span class="sh-string">"classroom/hvac/kettle_status"</span>) {
    isKettleOn = (<span class="sh-variable">payload</span> == <span class="sh-string">"ON"</span>);
    <span class="sh-function">digitalWrite</span>(LED_LIGHT_PIN, isKettleOn <span class="sh-operator">?</span> <span class="sh-literal">HIGH</span> <span class="sh-operator">:</span> <span class="sh-literal">LOW</span>); <span class="sh-comment">// Assuming LED_LIGHT_PIN maps to Kettle for visual feedback</span>
  }
  <span class="sh-comment">// Example: Update Main Lighting status LED.</span>
  <span class="sh-keyword">else if</span> (<span class="sh-variable">topic</span> == <span class="sh-string">"classroom/lighting/status"</span>) {
    isMainLightOn = (<span class="sh-variable">payload</span> == <span class="sh-string">"ON"</span>);
    <span class="sh-function">digitalWrite</span>(LED_LIGHT_PIN, isMainLightOn <span class="sh-operator">?</span> <span class="sh-literal">HIGH</span> <span class="sh-operator">:</span> <span class="sh-literal">LOW</span>);
  }
  <span class="sh-comment">// Example: Update Porch Light status LED.</span>
  <span class="sh-keyword">else if</span> (<span class="sh-variable">topic</span> == <span class="sh-string">"classroom/lighting/porch_status"</span>) {
    isPorchLightOn = (<span class="sh-variable">payload</span> == <span class="sh-string">"ON"</span>);
    <span class="sh-function">digitalWrite</span>(LED_DOOR_PIN, isPorchLightOn <span class="sh-operator">?</span> <span class="sh-literal">HIGH</span> <span class="sh-operator">:</span> <span class="sh-literal">LOW</span>); <span class="sh-comment">// Assuming LED_DOOR_PIN maps to Porch for visual feedback</span>
  }
  <span class="sh-comment">// Example: Update Door status LED (payload is "DOOR_STATE,LOCK_STATE").</span>
  <span class="sh-keyword">else if</span> (<span class="sh-variable">topic</span> == <span class="sh-string">"classroom/door/status"</span>) {
    isDoorLocked = (<span class="sh-variable">payload</span>.<span class="sh-function">indexOf</span>(<span class="sh-string">"LOCKED"</span>) <span class="sh-operator">!=</span> <span class="sh-number">-1</span>);
    <span class="sh-function">digitalWrite</span>(LED_CURTAIN_PIN, isDoorLocked <span class="sh-operator">?</span> <span class="sh-literal">HIGH</span> <span class="sh-operator">:</span> <span class="sh-literal">LOW</span>); <span class="sh-comment">// Assuming LED_CURTAIN_PIN maps to Door for visual feedback</span>
  }
  <span class="sh-comment">// Example: Update Curtain status LED.</span>
  <span class="sh-keyword">else if</span> (<span class="sh-variable">topic</span> == <span class="sh-string">"classroom/curtain/status"</span>) {
    isCurtainOpen = (<span class="sh-variable">payload</span> == <span class="sh-string">"OPEN"</span>);
    <span class="sh-function">digitalWrite</span>(LED_HVAC_PIN, isCurtainOpen ? HIGH : LOW); // Using HVAC LED as a temporary placeholder
  }

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// If you received a message on a "test/ping" topic:</span>
  <span class="sh-comment">// if (topic == "test/ping") { Serial.println("Ping received!"); }</span>
}</code></pre>
                </li>
                <li><b><code>loopMySensorLogic()</code>:</b> This is where you will check for button presses and publish
                    commands to other devices. Remember to use <code>publishTo()</code> and include debouncing.
                    <pre><code><span class="sh-keyword">void</span> <span class="sh-function">loopMySensorLogic</span>() {
  <span class="sh-comment">// This function handles checking button presses and sending commands.</span>
  <span class="sh-comment">// It runs repeatedly. Add simple debouncing (delay) after a press.</span>

  <span class="sh-comment">// Handle HVAC Button: Toggle ON/OFF for HVAC.</span>
  <span class="sh-keyword">if</span> (<span class="sh-function">digitalRead</span>(BUTTON_HVAC_PIN) <span class="sh-operator">==</span> <span class="sh-literal">LOW</span>) { <span class="sh-comment">// Button pressed (LOW because of INPUT_PULLUP)</span>
    <span class="sh-comment">// Use the global 'isHvacOn' state variable to decide which command to send.</span>
    <span class="sh-keyword">if</span> (isHvacOn) {
      myDevice.<span class="sh-function">publishTo</span>(<span class="sh-string">"classroom/hvac/command"</span>, <span class="sh-string">"HVAC_OFF"</span>);
      Serial.<span class="sh-function">println</span>(<span class="sh-string">"Panel Cmd: HVAC OFF"</span>);
    } <span class="sh-keyword">else</span> {
      myDevice.<span class="sh-function">publishTo</span>(<span class="sh-string">"classroom/hvac/command"</span>, <span class="sh-string">"HVAC_ON"</span>);
      Serial.<span class="sh-function">println</span>(<span class="sh-string">"Panel Cmd: HVAC ON"</span>);
    }
    <span class="sh-function">delay</span>(<span class="sh-number">250</span>); <span class="sh-comment">// Simple debounce to prevent multiple presses.</span>
  }

  <span class="sh-comment">// Handle Main Lighting Button: Toggle ON/OFF for main lights.</span>
  <span class="sh-keyword">if</span> (<span class="sh-function">digitalRead</span>(BUTTON_LIGHT_PIN) <span class="sh-operator">==</span> <span class="sh-literal">LOW</span>) {
    <span class="sh-keyword">if</span> (isMainLightOn) {
      myDevice.<span class="sh-function">publishTo</span>(<span class="sh-string">"classroom/lighting/command"</span>, <span class="sh-string">"SWITCH=OFF"</span>);
      Serial.<span class="sh-function">println</span>(<span class="sh-string">"Panel Cmd: LIGHTS OFF"</span>);
    } <span class="sh-keyword">else</span> {
      myDevice.<span class="sh-function">publishTo</span>(<span class="sh-string">"classroom/lighting/command"</span>, <span class="sh-string">"SWITCH=ON,BRIGHTNESS=255,COLOR=#FFFFFF"</span>);
      Serial.<span class="sh-function">println</span>(<span class="sh-string">"Panel Cmd: LIGHTS ON"</span>);
    }
    <span class="sh-function">delay</span>(<span class="sh-number">250</span>); 
  }

  <span class="sh-comment">// Handle Door Lock Button: Toggle LOCK/UNLOCK for the door.</span>
  <span class="sh-keyword">if</span> (<span class="sh-function">digitalRead</span>(BUTTON_DOOR_PIN) <span class="sh-operator">==</span> <span class="sh-literal">LOW</span>) {
    <span class="sh-keyword">if</span> (isDoorLocked) {
      myDevice.<span class="sh-function">publishTo</span>(<span class="sh-string">"classroom/door/command"</span>, <span class="sh-string">"UNLOCK"</span>);
      Serial.<span class="sh-function">println</span>(<span class="sh-string">"Panel Cmd: DOOR UNLOCK"</span>);
    } <span class="sh-keyword">else</span> {
      myDevice.<span class="sh-function">publishTo</span>(<span class="sh-string">"classroom/door/command"</span>, <span class="sh-string">"LOCK"</span>);
      Serial.<span class="sh-function">println</span>(<span class="sh-string">"Panel Cmd: DOOR LOCK"</span>);
    }
    <span class="sh-function">delay</span>(<span class="sh-number">250</span>); 
  }

  <span class="sh-comment">// Handle Curtain Button: Toggle OPEN/CLOSE for the curtain.</span>
  <span class="sh-keyword">if</span> (<span class="sh-function">digitalRead</span>(BUTTON_CURTAIN_PIN) <span class="sh-operator">==</span> <span class="sh-literal">LOW</span>) {
    <span class="sh-keyword">if</span> (isCurtainOpen) { <span class="sh-comment">// Assuming OPEN means the curtain is currently open.</span>
      myDevice.<span class="sh-function">publishTo</span>(<span class="sh-string">"classroom/curtain/command"</span>, <span class="sh-string">"CLOSE"</span>);
      Serial.<span class="sh-function">println</span>(<span class="sh-string">"Panel Cmd: CURTAIN CLOSE"</span>);
    } <span class="sh-keyword">else</span> {
      myDevice.<span class="sh-function">publishTo</span>(<span class="sh-string">"classroom/curtain/command"</span>, <span class="sh-string">"OPEN"</span>);
      Serial.<span class="sh-function">println</span>(<span class="sh-string">"Panel Cmd: CURTAIN OPEN"</span>);
    }
    <span class="sh-function">delay</span>(<span class="sh-number">250</span>); 
  }

  <span class="sh-comment">// Example of something unrelated to your mission:</span>
  <span class="sh-comment">// If you had an analog button to control a virtual fan speed:</span>
  <span class="sh-comment">// int fanSpeed = analogRead(A0) / 4; // Scale 0-1023 to 0-255</span>
  <span class="sh-comment">// myDevice.publishTo("classroom/virtual_fan/speed", String(fanSpeed));</span>
}</code></pre>
                </li>
            </ul>
            <h4 class="text-lg font-bold text-accent mt-6 mb-3">Success Criteria</h4>
            <p class="text-secondary">You've succeeded when pressing a button on your panel reliably toggles the state
                of its corresponding device elsewhere in the room (e.g., press HVAC button, the fan turns on/off). Most
                importantly, your panel's indicator LED for each function <i>always</i> shows the correct, real-time
                status of that device, even if the device was controlled by voice or another panel!</p>
            <div class="mt-8 bg-accent/10 border border-accent/30 border-l-4 border-l-accent px-6 py-4 rounded-xl">
                <h5 class="font-bold text-accent mb-2">Challenges &amp; Tips:</h5>
                <ul class="list-disc list-inside text-sm text-accent/80 space-y-2">
                    <li><b>Full Topic Paths:</b> Double-check that you are using the <i>exact</i> full topic paths for
                        both subscribing to status updates AND publishing commands (e.g.,
                        <code>classroom/hvac/status</code> vs. <code>classroom/hvac/command</code>).
                    </li>
                    <li><b>State Synchronization:</b> The biggest challenge is ensuring your panel's LEDs accurately
                        reflect the real state of the other devices. This requires the <code>onMessage</code> callback
                        to <i>immediately</i> update your global state variables and LEDs whenever a status message
                        comes in.</li>
                    <li><b>Debouncing Explained:</b> A physical button "bounces" when pressed, sending many rapid
                        HIGH/LOW signals. The <code>delay(250)</code> after a press is a simple "debounce" mechanism.
                        For more advanced projects, you'd use a timer-based approach.</li>
                    <li><b>Start-up State:</b> When your panel first turns on, it might not know the state of other
                        devices. It will learn their states as soon as they publish their next status update.</li>
                </ul>
            </div>
        </div>

        <div id="api-reference" class="page">
            <h1>SmartDevice Class API Reference</h1>
            <p class="license">McMaster Smart Classroom - Arduino IoT Library &copy; 2025 by Majd Aburas</p>

            <h2>Introduction</h2>
            <p>Welcome, McMaster Engineering campers!</p>
            <p>The <code>SmartDevice</code> library is a custom tool designed to make connecting your ESP8266 projects
                to the central Smart Classroom Hub incredibly simple. It handles all the complex Wi-Fi and MQTT (Message
                Queuing Telemetry Transport) networking code for you, so you can focus on the fun part: writing the
                logic for your unique sensor or actuator. This document is your comprehensive guide to using the
                library's features.</p>

            <hr />

            <h2>Safe Pin Definitions</h2>
            <p>To prevent errors and make wiring easier, the <code>SmartDevice</code> library includes definitions for
                the safe-to-use GPIO pins on your ESP8266 NodeMCU board. You should always use these friendly names
                (e.g., <code>PIN_D1</code>) instead of raw numbers (like <code>5</code> or <code>4</code>) in your code.
                This makes your code more readable and less prone to errors.</p>
            <table>
                <thead>
                    <tr>
                        <th>Safe Name</th>
                        <th>GPIO Number</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>PIN_D1</code></td>
                        <td><code>5</code></td>
                    </tr>
                    <tr>
                        <td><code>PIN_D2</code></td>
                        <td><code>4</code></td>
                    </tr>
                    <tr>
                        <td><code>PIN_D5</code></td>
                        <td><code>14</code></td>
                    </tr>
                    <tr>
                        <td><code>PIN_D6</code></td>
                        <td><code>12</code></td>
                    </tr>
                    <tr>
                        <td><code>PIN_D7</code></td>
                        <td><code>13</code></td>
                    </tr>
                </tbody>
            </table>
            <p><b>Example Usage:</b></p>
            <pre><code><span class="sh-comment">// Correct way to define a pin constant</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">MY_SENSOR_PIN</span> <span class="sh-variable">PIN_D5</span>

<span class="sh-comment">// Using the defined pin in setupMyHardware()</span>
<span class="sh-keyword">void</span> <span class="sh-function">setupMyHardware</span>() {
  <span class="sh-function">pinMode</span>(<span class="sh-variable">MY_SENSOR_PIN</span>, <span class="sh-literal">INPUT</span>);
}</code></pre>

            <h3 class="text-xl font-bold text-primary mb-3 mt-6">Understanding <code>pinMode()</code></h3>
            <p class="text-secondary">The <code>pinMode()</code> function is fundamental for controlling your hardware.
                It tells the ESP8266 whether a specific pin should be used for sending signals (output) or receiving
                signals (input).</p>
            <p class="text-secondary">Its syntax is: <code>pinMode(pin, mode);</code></p>
            <ul>
                <li><code>pin</code>: This is the GPIO pin number you want to configure (e.g., <code>PIN_D1</code>,
                    <code>PIN_D7</code>).
                </li>
                <li><code>mode</code>: This specifies how the pin will behave. You have three main options:
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li><code>INPUT</code>: Use this when the pin will be <i>reading</i> a signal from a sensor or
                            switch. The pin will detect if there's a HIGH (around 3.3V) or LOW (around 0V) voltage.</li>
                        <li><code>OUTPUT</code>: Use this when the pin will be <i>sending</i> a signal to control an
                            LED, motor, or relay. You can then set the pin HIGH or LOW using
                            <code>digitalWrite()</code>.
                        </li>
                        <li><code>INPUT_PULLUP</code>: This is a special type of <code>INPUT</code>. It enables a small
                            internal resistor that "pulls" the pin's voltage HIGH by default. It's incredibly useful for
                            simple switches (like buttons or magnetic contacts) connected directly to ground. When the
                            switch is open, it connects the pin to ground, pulling it LOW. This avoids "floating" pins,
                            which can pick up random electrical noise.</li>
                    </ul>
                </li>
            </ul>
            <p class="text-secondary mt-2"><b>When to use it:</b> You will always use <code>pinMode()</code> inside your
                <code>setupMyHardware()</code> function to configure all the pins your project uses at the very
                beginning.
            </p>
            <p class="text-secondary mt-2"><b>Unrelated Example: Simple Button and LED Test</b></p>
            <pre><code><span class="sh-comment">// Define pins at the top of your sketch (outside any function)</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">BUTTON_PIN</span> <span class="sh-variable">PIN_D1</span>   <span class="sh-comment">// Assuming a button wired to D1 and GND</span>
<span class="sh-preprocessor">#define</span> <span class="sh-variable">LED_PIN</span> <span class="sh-variable">PIN_D7</span>      <span class="sh-comment">// Assuming an LED wired to D7 (with a resistor) and GND</span>

<span class="sh-keyword">void</span> <span class="sh-function">setupMyHardware</span>() {
  <span class="sh-comment">// Configure the LED pin as an OUTPUT</span>
  <span class="sh-function">pinMode</span>(LED_PIN, <span class="sh-literal">OUTPUT</span>);
  <span class="sh-function">digitalWrite</span>(LED_PIN, <span class="sh-literal">LOW</span>); <span class="sh-comment">// Ensure LED is off initially</span>

  <span class="sh-comment">// Configure the button pin as an INPUT with internal PULLUP resistor</span>
  <span class="sh-function">pinMode</span>(BUTTON_PIN, <span class="sh-literal">INPUT_PULLUP</span>); 
}

<span class="sh-keyword">void</span> <span class="sh-function">loopMySensorLogic</span>() {
  <span class="sh-comment">// Read the state of the button. It will be LOW when pressed.</span>
  <span class="sh-type">int</span> buttonState = <span class="sh-function">digitalRead</span>(BUTTON_PIN);

  <span class="sh-comment">// If the button is pressed (LOW), turn the LED ON, otherwise turn it OFF.</span>
  <span class="sh-keyword">if</span> (buttonState <span class="sh-operator">==</span> <span class="sh-literal">LOW</span>) {
    <span class="sh-function">digitalWrite</span>(LED_PIN, <span class="sh-literal">HIGH</span>); <span class="sh-comment">// Turn LED ON</span>
  } <span class="sh-keyword">else</span> {
    <span class="sh-function">digitalWrite</span>(LED_PIN, <span class="sh-literal">LOW</span>); <span class="sh-comment">// Turn LED OFF</span>
  }

  <span class="sh-comment">// (No need to publish to the cloud for this simple test, just observe with the LED)</span>
}</code></pre>

            <h3><code>SmartDevice myDevice;</code></h3>
            <p>This line is already in your <code>UniversalDeviceTemplate.ino</code>! It creates an instance of the
                <code>SmartDevice</code> class, named <code>myDevice</code>. You will use this object to call all the
                library's functions.
            </p>
            <pre><code><span class="sh-comment">// This line is already in UniversalDeviceTemplate.ino. Do not add it again.
<span class="sh-class">SmartDevice</span> <span class="sh-variable">myDevice</span>;</span></code></pre>

            <h3><code>void begin(const char* deviceName, const char* wifi_ssid, const char* wifi_pass, const char* mqtt_broker)</code>
            </h3>
            <p><b>What it does:</b> This function is responsible for initiating your device's connection to the Wi-Fi
                network and the central MQTT message broker. It's the critical first step to getting your device online.
            </p>
            <p><b>When to use it:</b> You do <b>not</b> call this function directly in your code. It is automatically
                called by the "System Engine" in your <code>UniversalDeviceTemplate.ino</code>'s main
                <code>setup()</code> function. You simply provide the necessary configuration details
                (<code>DEVICE_NAME</code>, <code>WIFI_SSID</code>, <code>WIFI_PASSWORD</code>,
                <code>MQTT_BROKER_IP</code>) at the top of your sketch.
            </p>
            <p><b>Parameters (configured by you at the top of the template):</b></p>
            <ul>
                <li><code>deviceName</code>: A unique name for your specific device (e.g.,
                    <code>"Sarah_Door_Lock"</code>).
                </li>
                <li><code>wifi_ssid</code>: The name of the Wi-Fi network (<code>"McMasterIoT-Camp"</code>).</li>
                <li><code>wifi_pass</code>: The password for the Wi-Fi network (<code>"Roomba2025"</code>).</li>
                <li><code>mqtt_broker</code>: The IP address of the central hub computer (<code>"192.168.0.147"</code>).
                </li>
            </ul>

            <h3><code>void update()</code></h3>
            <p><b>What it does:</b> This function is the "heartbeat" of the <code>SmartDevice</code> library. It
                continuously keeps your device connected to the MQTT hub and checks for any new messages that have
                arrived for your device. If this function isn't called regularly, your device will not be able to send
                or receive messages.</p>
            <p><b>When to use it:</b> You do <b>not</b> call this function directly in your code. It is automatically
                called by the "System Engine" at the very beginning of the <code>UniversalDeviceTemplate.ino</code>'s
                main <code>loop()</code> function. This ensures that your device is always responsive to the network.
            </p>

            <h3><code>void publishTo(String fullTopic, String payload)</code></h3>
            <p><b>What it does:</b> This is your primary tool for sending information from your device to the central
                hub, or even sending commands directly to other devices in the classroom (especially useful for the
                Master Control Panel). You tell it exactly which "address" (topic) to send the message to and what the
                message content (payload) should be.</p>
            <p><b>When to use it:</b></p>
            <ul>
                <li>In your <code>loopMySensorLogic()</code> function, to send sensor readings or status updates from
                    your device to the cloud.</li>
                <li>In your <code>handleMyActuatorLogic()</code> function, to report the status of an actuator after it
                    has changed state (e.g., turning a light ON, report "ON" status).</li>
                <li>In Station 6 (Master Control Panel), to send commands to other devices in the classroom.</li>
            </ul>
            <p><b>Parameters:</b></p>
            <ul>
                <li><code>fullTopic</code> (<code>String</code>): The complete MQTT topic path you want to publish to.
                    Examples:
                    <ul>
                        <li>For your device's status: The <code>STATUS_TOPIC</code> you defined (e.g.,
                            <code>"classroom/door/status"</code>).
                        </li>
                        <li>For another device's command: That device's <code>COMMAND_TOPIC</code> (e.g.,
                            <code>"classroom/lighting/command"</code>).
                        </li>
                        <li>For a specific sub-topic: A custom path (e.g., <code>"classroom/hvac/kettle_status"</code>).
                        </li>
                    </ul>
                </li>
                <li><code>payload</code> (<code>String</code>): The actual data or message you want to send. This will
                    be the text that the receiving device or the cloud system interprets. Examples: <code>"ON"</code>,
                    <code>"OFF"</code>, <code>"CLOSED,LOCKED"</code>, <code>"temp:23.1,motion:true"</code>.
                </li>
            </ul>
            <p class="text-secondary mt-2"><b>Example Use (conceptual):</b></p>
            <pre><code><span class="sh-keyword">void</span> <span class="sh-function">loopMySensorLogic</span>() {
  <span class="sh-comment">// Imagine reading a light sensor and sending its value:</span>
  <span class="sh-type">int</span> lightLevel = <span class="sh-function">analogRead</span>(<span class="sh-literal">A0</span>); <span class="sh-comment">// Reads an analog sensor on pin A0</span>
  myDevice.<span class="sh-function">publishTo</span>(<span class="sh-string">"classroom/mylight_sensor/data"</span>, <span class="sh-type">String</span>(lightLevel));
  Serial.<span class="sh-function">print</span>(<span class="sh-string">"Published light level: "</span>); Serial.<span class="sh-function">println</span>(lightLevel);
}</code></pre>

            <h3><code>void subscribeTo(String fullTopic)</code></h3>
            <p><b>What it does:</b> This function allows your device to "listen" for messages published to a specific
                MQTT topic. When a message is sent to a topic you've subscribed to, your device will receive it and can
                then react to it.</p>
            <p><b>When to use it:</b></p>
            <ul>
                <li>In your <code>setupMyHardware()</code> function, if your device needs to listen to additional topics
                    beyond its default <code>COMMAND_TOPIC</code> (which is handled automatically by the template).</li>
                <li><b>Crucially for Station 6 (Master Control Panel):</b> You will use this extensively in
                    <code>setupMyHardware()</code> to subscribe to the <code>STATUS_TOPIC</code> of <i>other</i> devices
                    in the classroom, so your panel can know their current state.
                </li>
            </ul>
            <p><b>Parameters:</b></p>
            <ul>
                <li><code>fullTopic</code> (<code>String</code>): The complete MQTT topic path you want to listen to.
                    Examples: <code>"classroom/hvac/status"</code>, <code>"classroom/door/status"</code>.</li>
            </ul>
            <p class="text-secondary mt-2"><b>Example Use (conceptual):</b></p>
            <pre><code><span class="sh-keyword">void</span> <span class="sh-function">setupMyHardware</span>() {
  <span class="sh-comment">// ... other hardware setup ...</span>
  <span class="sh-comment">// Tell the hub we want to receive status updates from the classroom's main light.</span>
  myDevice.<span class="sh-function">subscribeTo</span>(<span class="sh-string">"classroom/lighting/status"</span>); 
  Serial.<span class="sh-function">println</span>(<span class="sh-string">"Subscribed to lighting status."</span>);
}</code></pre>

            <h3><code>void onMessage(MessageCallback callback)</code></h3>
            <p><b>What it does:</b> This is the advanced way to handle incoming messages. It registers a function (your
                <code>callback</code>) that will be called whenever <i>any</i> MQTT message arrives on a topic your
                device is subscribed to. Your function will receive <i>both</i> the <code>topic</code> and the
                <code>payload</code> of the message.
            </p>
            <p><b>When to use it:</b></p>
            <ul>
                <li>For most stations, this is handled automatically by the "System Engine" in your template, which
                    routes incoming commands to your <code>handleMyActuatorLogic(payload)</code> function. You typically
                    won't call <code>onMessage()</code> directly.</li>
                <li><b>However, for Station 6 (Master Control Panel):</b> You <b>will</b> use this function explicitly
                    in your <code>setupMyHardware()</code> to register your own custom message handling function (e.g.,
                    <code>handlePanelMessages</code>). This allows your panel to differentiate between status updates
                    from many different devices based on the <code>topic</code> of the message.
                </li>
            </ul>
            <p><b>Parameters:</b></p>
            <ul>
                <li><code>callback</code> (<code>MessageCallback</code>): A pointer to your custom function that will
                    handle the incoming messages. This function must have the signature:
                    <code>void myFunction(String topic, String payload)</code>.
                </li>
            </ul>
            <p class="text-secondary mt-2"><b>Example Use (conceptual, for Master Control Panel):</b></p>
            <pre><code><span class="sh-comment">// 1. Define your custom message handler function for the panel.</span>
<span class="sh-keyword">void</span> <span class="sh-function">handlePanelMessages</span>(<span class="sh-type">String</span> <span class="sh-variable">topic</span>, <span class="sh-type">String</span> <span class="sh-variable">payload</span>) {
  Serial.<span class="sh-function">printf</span>(<span class="sh-string">"Panel received: Topic: %s, Payload: %s\\n"</span>, <span class="sh-variable">topic</span>.<span class="sh-function">c_str</span>(), <span class="sh-variable">payload</span>.<span class="sh-function">c_str</span>());
  <span class="sh-comment">// Use if/else if to determine which device sent the message and update LEDs/states.</span>
  <span class="sh-keyword">if</span> (<span class="sh-variable">topic</span> == <span class="sh-string">"classroom/curtain/status"</span>) {
    <span class="sh-comment">// Logic to update curtain status LED based on payload (e.g., "OPEN", "CLOSED").</span>
  } <span class="sh-keyword">else if</span> (<span class="sh-variable">topic</span> == <span class="sh-string">"classroom/hvac/status"</span>) {
    <span class="sh-comment">// Logic to update HVAC status LED based on payload (e.g., "ON", "OFF").</span>
  }
}

<span class="sh-comment">// 2. In your setupMyHardware() function, register your custom handler:</span>
<span class="sh-keyword">void</span> <span class="sh-function">setupMyHardware</span>() {
  <span class="sh-comment">// ... other hardware setup and subscriptions ...</span>
  myDevice.<span class="sh-function">onMessage</span>(handlePanelMessages); <span class="sh-comment">// This replaces the template's default behavior.</span>
  Serial.<span class="sh-function">println</span>(<span class="sh-string">"Custom panel message handler registered."</span>);
}</code></pre>

            <hr />

            <h2>Licensing</h2>
            <p class="license">This library is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike
                4.0 International License. To view a copy of this license, visit <a
                    href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
                    target="_blank">https://creativecommons.org/licenses/by-nc-sa/4.0/</a></p>
        </div>

        <div id="upload-troubleshoot" class="page">
            <h1 class="text-4xl md:text-5xl font-bold text-center text-primary mb-4">Uploading &amp; Troubleshooting
            </h1>
            <p class="text-center text-secondary text-lg mb-8">Even the best engineers encounter challenges! This
                section will guide you through the process of uploading your code to the ESP8266 board and provide
                essential troubleshooting tips to get you back on track.</p>

            <hr />

            <h2 class="text-3xl font-bold text-primary border-b border-custom-border pb-3 mb-6">1. Uploading Your Code
                to ESP8266</h2>
            <p class="text-secondary">Once you've written your code in the Arduino IDE, you need to upload it to your
                ESP8266 board. Follow these steps carefully:</p>
            <ol class="list-decimal list-inside space-y-3 pl-4 text-primary">
                <li><b>Select Board:</b>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>In the Arduino IDE, go to <code>Tools &gt; Board &gt; ESP8266 Boards</code>.</li>
                        <li>Select <b><code>NodeMCU 1.0 (ESP-12E Module)</code></b>.</li>
                    </ul>
                </li>
                <li><b>Select Port:</b>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>Connect your ESP8266 board to your computer using a USB cable.</li>
                        <li>Go to <code>Tools &gt; Port</code>.</li>
                        <li>Select the serial port that corresponds to your ESP8266. It might appear as
                            <code>COMx</code> (on Windows) or <code>/dev/cu.usbserial-xxxx</code> (on Mac/Linux). If
                            you're unsure, unplug the board, check the list, then plug it back in and see which new port
                            appears.
                        </li>
                    </ul>
                </li>
                <li><b>Prepare for Upload (If needed):</b>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>Some ESP8266 boards automatically enter upload mode. If yours doesn't, you might need to
                            manually put it into "flash mode" or "upload mode":
                            <ol class="list-alpha list-inside ml-4 mt-2">
                                <li><b>Unplug</b> your ESP8266 board from the USB cable.</li>
                                <li><b>Hold down the "FLASH" or "BOOT" button</b> on the ESP8266 board.</li>
                                <li>While still holding the "FLASH" button, <b>plug the USB cable back in</b>.</li>
                                <li>Release the button after 1-2 seconds.</li>
                            </ol>
                        </li>
                    </ul>
                </li>
                <li><b>Upload Code:</b>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>Click the <b>"Upload" button</b> (the right-pointing arrow icon) in the Arduino IDE.</li>
                        <li>Watch the output window at the bottom of the IDE. You should see messages indicating
                            compilation progress and then upload progress.</li>
                        <li>A successful upload will show "Done uploading."</li>
                    </ul>
                </li>
                <li><b>Open Serial Monitor:</b>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>After uploading, click the <b>"Serial Monitor" button</b> (the magnifying glass icon) in the
                            top-right corner of the Arduino IDE.</li>
                        <li>Make sure the baud rate in the Serial Monitor (bottom right dropdown) is set to
                            <b><code>115200 baud</code></b>.
                        </li>
                        <li>You should now see output from your ESP8266, including connection messages and any
                            <code>Serial.println()</code> statements you added to your code.
                        </li>
                    </ul>
                </li>
            </ol>

            <hr />

            <h2 class="text-3xl font-bold text-primary border-b border-custom-border pb-3 mb-6">2. Common
                Troubleshooting Tips</h2>
            <p class="text-secondary">If your code isn't working as expected, don't panic! Here are some common issues
                and how to fix them:</p>

            <h3 class="text-xl font-bold text-primary mb-3">Serial Monitor Output</h3>
            <ul class="list-disc list-inside pl-4 space-y-2">
                <li><b>No output or weird characters:</b>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>Make sure the baud rate in the Serial Monitor is set to <b><code>115200 baud</code></b>.
                        </li>
                        <li>Ensure you've selected the correct <b>Port</b> (<code>Tools &gt; Port</code>).</li>
                        <li>Try pressing the "RST" or "EN" button on your ESP8266 board to restart it.</li>
                    </ul>
                </li>
                <li><b>"Connecting to Wi-Fi..." dots keep printing:</b>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>Double-check your <code>WIFI_SSID</code> and <code>WIFI_PASSWORD</code> in your code. They
                            must be an exact match (case-sensitive!).</li>
                        <li>Ensure the Wi-Fi network (<code>McMasterIoT-Camp</code>) is active and available.</li>
                        <li>The Wi-Fi router might be too far away. Try moving closer.</li>
                    </ul>
                </li>
                <li><b>"Attempting MQTT connection..." keeps printing:</b>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>Verify your <code>MQTT_BROKER_IP</code> address is correct (<code>192.168.0.147</code> by
                            default). Confirm with your instructor.</li>
                        <li>Ensure the MQTT Broker application (<code>run_broker.bat</code>) is running on the hub
                            computer.</li>
                        <li>Ensure the <code>SmartClassroomHub.exe</code> is also running on the hub computer.</li>
                        <li>Check if the hub computer's firewall is blocking the MQTT port (1883). Your instructor can
                            help with this.</li>
                    </ul>
                </li>
            </ul>

            <h3 class="text-xl font-bold text-primary mb-3">Upload Issues</h3>
            <ul class="list-disc list-inside pl-4 space-y-2">
                <li><b>"Failed to connect to ESP8266: Timed out waiting for packet header":</b>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>You probably need to manually put the ESP8266 into "flash mode" before uploading. Refer to
                            "Prepare for Upload" section above.</li>
                        <li>Ensure you have the correct board (NodeMCU 1.0) and port selected.</li>
                        <li>Try a different USB cable, as some cables are only for charging and don't carry data.</li>
                        <li>Restart the Arduino IDE and try again.</li>
                    </ul>
                </li>
                <li><b>"Error: espcomm_open failed" or "COM port not found":</b>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>The board is not properly connected, or the drivers are not installed. Try unplugging and
                            replugging the USB cable.</li>
                        <li>On some computers, you might need to install a USB-to-Serial driver (like CP210x or CH340).
                            Ask your instructor for help if you suspect this is the issue.</li>
                    </ul>
                </li>
            </ul>

            <h3 class="text-xl font-bold text-primary mb-3">Code Logic &amp; Hardware Issues</h3>
            <ul class="list-disc list-inside pl-4 space-y-2">
                <li><b>Device not reacting to commands or not sending data:</b>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li><b>Are you making blocking calls in your <code>loopMySensorLogic()</code>?</b> While the
                            System Engine calls <code>myDevice.update()</code>, if your <code>loopMySensorLogic()</code>
                            contains very long <code>delay()</code> calls or infinite loops, it can prevent
                            <code>myDevice.update()</code> from running often enough to process network messages. Try to
                            keep <code>loopMySensorLogic()</code> short and efficient.
                        </li>
                        <li>Double-check your <code>COMMAND_TOPIC</code> and <code>STATUS_TOPIC</code> in your code. Are
                            they exactly what your instructor provided for your station?</li>
                        <li>Use <code>Serial.println()</code> statements extensively! Print the values of your sensors,
                            the commands you receive, and the payloads you are publishing. This helps you "see" what
                            your code is doing.</li>
                        <li><b>Wiring Check:</b> Carefully re-examine your circuit. Are all connections solid? Is power
                            (3V3/VIN) and ground (GND) connected correctly to all components (ESP, sensors, actuators)?
                            Are the signal pins on the correct GPIOs?</li>
                        <li><b>Resistors:</b> For LEDs, always use a current-limiting resistor (e.g., 220 Ohm).</li>
                        <li><b>Servo/Relay Power:</b> If motors or relays are not responding, ensure they are receiving
                            sufficient power. Servos and relays often need more power than an ESP's digital pin can
                            provide; they should be powered from <code>VIN</code> or an external supply as instructed.
                        </li>
                    </ul>
                </li>
                <li><b>"My sensor reads weird values (e.g., -999, NaN)":</b>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>Ensure you have the correct library included (e.g., <code>#include &lt;DHT.h&gt;</code>).
                        </li>
                        <li>Double-check the sensor's wiring, especially the data pin and power connections.</li>
                        <li>Some sensors (like DHT) need a short delay between reads.</li>
                    </ul>
                </li>
            </ul>
            <div class="mt-8 bg-accent/10 border border-accent/30 border-l-4 border-l-accent px-6 py-4 rounded-xl">
                <h4 class="font-bold text-lg text-accent mb-2">Remember: Google is Your Friend!</h4>
                <p class="text-sm text-accent/80">If you encounter an error message, copy and paste it into Google!
                    Chances are, someone else has had the same problem, and solutions are often found on Arduino forums,
                    Stack Overflow, or ESP8266 community pages. Don't be afraid to experiment and learn from your
                    mistakes!</p>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Element References ---
            const pages = document.querySelectorAll('.page');
            const navLinks = document.querySelectorAll('.nav-item, .dropdown-item');
            const dropdownContainer = document.getElementById('dropdown-container');
            const dropdownButton = document.getElementById('nav-missions-btn');
            const dropdownMenu = document.getElementById('dropdown-menu');
            const dropdownArrow = document.getElementById('dropdown-arrow');

            function showPage(pageId) {
                pages.forEach(page => page.classList.remove('active'));

                const activePage = document.getElementById(pageId);
                if (activePage) {
                    activePage.classList.add('active');
                }

                navLinks.forEach(link => {
                    const isDropdownButton = link.id === 'nav-missions-btn';
                    const isForCurrentPage = link.dataset.page === pageId;
                    const isDropdownPageActive = activePage && activePage.id.startsWith('station');

                    link.classList.remove('bg-accent', 'text-custom-bg', 'font-bold');
                    link.classList.add('text-secondary', 'hover:bg-custom-border', 'hover:text-primary');

                    if (isForCurrentPage && !link.classList.contains('dropdown-item')) {
                        link.classList.add('bg-accent', 'text-custom-bg', 'font-bold');
                        link.classList.remove('text-secondary', 'hover:bg-custom-border', 'hover:text-primary');
                    }
                    else if (isDropdownButton && isDropdownPageActive) {
                        link.classList.add('bg-accent', 'text-custom-bg', 'font-bold');
                        link.classList.remove('text-secondary', 'hover:bg-custom-border', 'hover:text-primary');
                    }
                });

                closeDropdown();
                // Call chart rendering function when the infographic page is active
                if (pageId === 'overview') {
                    renderInfographicCharts();
                }
            }

            function openDropdown() {
                dropdownMenu.classList.remove('hidden');
                dropdownArrow.style.transform = 'rotate(180deg)';
            }

            function closeDropdown() {
                dropdownMenu.classList.add('hidden');
                dropdownArrow.style.transform = 'rotate(0deg)';
            }

            // --- Event Listeners ---
            navLinks.forEach(link => {
                if (link.dataset.page) {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        showPage(link.dataset.page);
                        window.scrollTo(0, 0);
                    });
                }
            });

            dropdownButton.addEventListener('click', (event) => {
                event.stopPropagation();
                const isHidden = dropdownMenu.classList.contains('hidden');
                if (isHidden) {
                    openDropdown();
                } else {
                    closeDropdown();
                }
            });

            window.addEventListener('click', (event) => {
                if (!dropdownContainer.contains(event.target)) {
                    closeDropdown();
                }
            });

            // --- Initialization ---
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.add('text-secondary', 'hover:bg-custom-border', 'hover:text-primary');
            });
            document.querySelectorAll('.dropdown-item').forEach(item => {
                item.classList.add('block', 'w-full', 'text-left', 'px-4', 'py-2', 'text-sm', 'text-primary', 'hover:bg-accent', 'hover:text-custom-bg', 'transition-colors', 'rounded-lg');
            });

            showPage('home'); // Show home page on initial load

            // Chart rendering function for the infographic page
            function renderInfographicCharts() {
                // Utility function to wrap Chart.js labels
                function wrapLabel(label, maxLength = 16) {
                    if (label.length <= maxLength) {
                        return label;
                    }
                    const words = label.split(' ');
                    let lines = [];
                    let currentLine = '';
                    words.forEach(word => {
                        if ((currentLine + word).length > maxLength && currentLine.length > 0) {
                            lines.push(currentLine.trim());
                            currentLine = word + ' ';
                        } else {
                            currentLine += word + ' ';
                        }
                    });
                    if (currentLine.length > 0) {
                        lines.push(currentLine.trim());
                    }
                    return lines;
                }

                const tooltipConfig = {
                    plugins: {
                        tooltip: {
                            callbacks: {
                                title: function (tooltipItems) {
                                    const item = tooltipItems[0];
                                    let label = item.chart.data.labels[item.dataIndex];
                                    if (Array.isArray(label)) {
                                        return label.join(' ');
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: { // Also define legend callbacks for proper multi-line labels if needed
                            labels: {
                                color: '#BDC1C6', // Secondary text color for legend
                                padding: 20,
                                font: { family: 'Product Sans' }
                            }
                        }
                    }
                };

                // Chart 2: Troubleshooting Hotspots (Doughnut Chart)
                const troubleshootingCtx = document.getElementById('troubleshootingChart');
                if (troubleshootingCtx) { // Check if canvas exists on the current page
                    const existingChart = Chart.getChart(troubleshootingCtx);
                    if (existingChart) existingChart.destroy(); // Destroy previous instance to prevent duplicates

                    new Chart(troubleshootingCtx.getContext('2d'), {
                        type: 'doughnut',
                        data: {
                            labels: [
                                wrapLabel('Wi-Fi / Network Connection'),
                                wrapLabel('Code Logic & Syntax Errors'),
                                wrapLabel('Upload / Port Issues'),
                                wrapLabel('Physical Wiring Mistakes')
                            ],
                            datasets: [{
                                label: 'Common Bug Hotspots',
                                data: [40, 30, 20, 10], /* Example data distribution */
                                backgroundColor: ['#8ab4f8', '#ef5350', '#ffb300', '#2196f3'], /* Accent, Error-Red, Warning-Yellow, Info-Blue */
                                borderColor: 'transparent', /* Removed border */
                                borderWidth: 0,
                                hoverOffset: 4
                            }]
                        },
                        options: {
                            ...tooltipConfig,
                            maintainAspectRatio: false,
                            cutout: '60%', /* Doughnut thickness */
                            plugins: {
                                ...tooltipConfig.plugins,
                                legend: {
                                    display: false /* Removed legend */
                                }
                            }
                        }
                    });
                }
            }
        });
    </script>

</body>

</html>
