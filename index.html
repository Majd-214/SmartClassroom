<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>McMaster Engineering Camp - IoT Kickoff</title>

    <!-- Google Fonts: Product Sans (via cdnfonts), Fira Code, and Material Icons -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.cdnfonts.com/css/product-sans" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>

    <style>
        /* ====================================================================
           McMaster Smart Classroom - Presentation Stylesheet v12 (Polished)
           ==================================================================== */

        /* --- Base Setup & Theming --- */
        :root {
            --bg-dark: #202124;
            --bg-surface: #2d2e30;
            --text-primary: #e8eaed;
            --text-secondary: #bdc1c6;
            --accent-blue: #8ab4f8;
            --accent-green: #34a853;
            --accent-red: #ea4335;
            --accent-yellow: #fbbc05;
            --mcmaster-maroon: #7A003C;
        }

        * {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Product Sans', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            margin: 0;
            overflow-x: hidden;
            /* Prevent horizontal scrollbar */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .main-container {
            height: 100vh;
            overflow-y: scroll;
            overflow-x: hidden;
            scroll-snap-type: y mandatory;
            /* Add these three lines to hide the scrollbar */
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        .main-container::-webkit-scrollbar {
            display: none;
            /* Chrome, Safari, and Opera */
        }

        /* --- Navigation --- */
        #slide-nav {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .nav-arrow {
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: color 0.3s, transform 0.3s;
            font-size: 24px;
        }

        .nav-arrow:hover {
            color: var(--text-primary);
            transform: scale(1.2);
        }

        #nav-dots {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .nav-dot {
            width: 10px;
            height: 10px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }

        .nav-dot.active {
            background-color: var(--accent-blue);
            transform: scale(1.4);
        }

        /* --- Scroll-based Slides (CENTERED) --- */
        .slide {
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem 4vw;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid #3c4043;
            scroll-snap-align: start;
        }

        .slide-content {
            max-width: 1200px;
            width: 100%;
            text-align: center;
            z-index: 2;
            align-content: center;
            justify-content: center;
            align-items: center;
        }

        /* --- Typography & Common Elements --- */
        h1 {
            font-size: clamp(2.2rem, 5vw, 4rem);
            font-weight: 700;
            margin: 0 0 0.8rem 0;
            line-height: 1.1;
            letter-spacing: -0.02em;
        }

        h2 {
            font-size: clamp(1.1rem, 2vw, 1.6rem);
            font-weight: 400;
            margin: 0 0 1.5rem 0;
            color: var(--text-secondary);
            line-height: 1.5;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        h3 {
            font-size: clamp(1.2rem, 2vw, 1.8rem);
            font-weight: 700;
            margin: 0 0 1.5rem 0;
        }

        p {
            font-size: clamp(1rem, 1.5vw, 1.25rem);
            line-height: 1.7;
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto;
        }

        .highlight {
            color: var(--accent-blue);
            font-weight: bold;
        }

        .material-icons {
            font-size: inherit;
            vertical-align: middle;
        }

        /* --- Animation Setup --- */
        .reveal {
            opacity: 0;
            transform: translateY(40px);
            transition: opacity 1s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .slide.is-visible .reveal {
            opacity: 1;
            transform: translateY(0);
        }

        .reveal.delay-1 {
            transition-delay: 0.2s;
        }

        .reveal.delay-2 {
            transition-delay: 0.4s;
        }

        .reveal.delay-3 {
            transition-delay: 0.6s;
        }

        /* --- Specific Slide Styles --- */
        #slide-1 #mcmaster-logo {
            width: 100%;
            max-width: 600px;
            height: auto;
            margin-bottom: 2rem;
        }

        #slide-1 .subtitle {
            font-size: clamp(1.5rem, 2.5vw, 2.2rem);
            /* Makes subtitle larger */
            margin-top: 1rem;
            /* Adds space above the subtitle */
            color: var(--accent-blue);
        }

        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 1;
        }

        #iot-diagram {
            position: relative;
            width: 450px;
            height: 200px;
            margin: 2rem auto;
        }

        .iot-node {
            position: absolute;
            background-color: var(--bg-surface);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: pulse 4s infinite ease-in-out;
        }

        .iot-node:hover {
            transform: translate(-50%, -50%) scale(1.1) !important;
            box-shadow: 0 0 30px var(--accent-blue);
            animation-play-state: paused;
        }

        .iot-node .material-icons {
            font-size: 3rem;
        }

        #iot-brain {
            width: 160px;
            height: 160px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            color: var(--accent-blue);
            border: 4px solid var(--accent-blue);
            animation-delay: 0s;
        }

        .iot-satellite {
            width: 90px;
            height: 90px;
        }

        #iot-diagram svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        #iot-diagram .connection-line {
            stroke: var(--accent-blue);
            stroke-width: 2;
            stroke-dasharray: 5;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        #iot-diagram.is-visible .connection-line {
            opacity: 0.5;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: translate(-50%, -50%) scale(0.95);
                box-shadow: 0 0 0 0 rgba(138, 180, 248, 0.7);
            }

            70% {
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 0 0 0 10px rgba(138, 180, 248, 0);
            }
        }

        /* Anatomy of a Message */
        .message-anatomy-container {
            display: flex;
            gap: 1rem;
            justify-content: center;
            align-items: center;
            margin-top: 2rem;
            font-family: 'Fira Code', monospace;
        }

        .message-part {
            background-color: var(--bg-surface);
            padding: 1.5rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
        }

        .message-part:hover {
            transform: translateY(-5px);
        }

        .message-part.topic {
            border-color: var(--accent-red);
        }

        .message-part.payload {
            border-color: var(--accent-yellow);
        }

        .message-part .label {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .message-part .value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 0.5rem;
        }

        #message-explanation {
            margin: 2rem auto 0 auto;
            background-color: var(--bg-surface);
            padding: 1.5rem;
            border-radius: 12px;
            max-width: 700px;
            min-height: 100px;
            transition: opacity 0.4s;
        }

        /* Code to Cloud */
        #code-to-cloud-diagram {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            /* Align to top to position line correctly */
            width: 100%;
            max-width: 1000px;
            margin: 2rem auto;
            position: relative;
        }

        .arch-node {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            z-index: 2;
            width: 120px;
            /* Give nodes a fixed width */
        }

        .arch-node .material-icons {
            font-size: 5rem;
            padding: 1rem;
            background-color: var(--bg-surface);
            border-radius: 50%;
            height: 7rem;
            /* 5rem font + 2rem padding */
            width: 7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #code-to-cloud-diagram .line-container {
            position: absolute;
            top: 3rem;
            /* Vertically center with icons (7rem / 2) */
            left: 10%;
            /* Adjust to align with nodes */
            width: 80%;
            height: 4px;
            z-index: 1;
        }

        #code-to-cloud-diagram .line-container svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        .data-packet {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: var(--accent-green);
            border-radius: 50%;
            opacity: 0;
            top: 2px;
            /* Center packet on the line */
            left: 0;
            z-index: 5;
        }

        /* Comparison Grid */
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2.5rem;
            width: 100%;
            margin-top: 3rem;
        }

        .grid-card {
            background-color: var(--bg-surface);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid #3c4043;
            text-align: left;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .grid-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .grid-card h3 {
            color: var(--accent-blue);
            border-bottom: 2px solid var(--accent-blue);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .grid-card .analogy {
            font-style: italic;
            color: var(--text-secondary);
            margin-top: 1rem;
            border-left: 3px solid var(--accent-green);
            padding-left: 1rem;
        }

        /* MQTT Slide Redesign (FIXED) */
        #mqtt-diagram {
            position: relative;
            background-color: var(--bg-dark);
            border-radius: 16px;
            height: 400px;
            display: grid;
            grid-template-columns: 1fr 1.2fr 1fr;
            grid-template-rows: 1fr 1fr;
            align-items: center;
            justify-items: center;
            margin-top: 1rem;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        #mqtt-diagram svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        #mqtt-diagram .anim-path {
            fill: none;
            stroke: none;
        }

        .mqtt-element {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 1rem;
            border-radius: 12px;
            transition: all 0.3s;
            border: 2px solid transparent;
            text-align: center;
            z-index: 2;
        }

        .mqtt-element:hover {
            background-color: rgba(255, 255, 255, 0.05);
            transform: translateY(-5px);
        }

        .mqtt-element .material-icons {
            font-size: 4rem;
            transition: color 0.5s ease;
        }

        .mqtt-element.subscribed {
            border-color: var(--accent-green);
            box-shadow: 0 0 15px var(--accent-green);
        }

        #mqtt-broker {
            color: var(--accent-blue);
            cursor: default;
            grid-column: 2;
            grid-row: 1 / 3;
        }

        #mqtt-broker:hover {
            transform: none;
            background-color: transparent;
        }

        #mqtt-sensor {
            grid-column: 1;
            grid-row: 1 / 3;
        }

        #mqtt-actuator {
            grid-column: 3;
            grid-row: 1;
        }

        #mqtt-dashboard {
            grid-column: 3;
            grid-row: 2;
        }

        .message-bubble {
            position: absolute;
            /* This transform centers the bubble on the coordinates we provide. */
            transform: translate(-50%, -50%);
            background-color: var(--accent-green);
            color: var(--bg-dark);
            border-radius: 50%;
            font-weight: bold;
            opacity: 0;
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
        }

        .message-bubble .material-icons {
            font-size: 24px;
        }

        .dashboard-display {
            margin-top: 0.5rem;
            font-family: 'Product Sans', sans-serif;
            color: var(--accent-blue);
            font-size: 1.2rem;
            background-color: var(--bg-surface);
            padding: 0.25rem 0.75rem;
            border-radius: 8px;
        }

        /* Real World IoT */
        .real-world-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            width: 100%;
            max-width: 1100px;
            margin-top: 2rem;
            perspective: 1000px;
        }

        /* Add this rule to center the main content blocks on their respective slides */
        .real-world-grid,
        #code-to-cloud-diagram,
        .toolkit-container,
        .component-grid,
        .steps-grid,
        #automation-container {
            margin-left: auto;
            margin-right: auto;
        }

        .flip-card {
            background-color: transparent;
            height: 280px;
            cursor: pointer;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .flip-card.is-flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front,
        .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            background-color: var(--bg-surface);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
        }

        .flip-card-front .material-icons {
            font-size: 5rem;
            margin-bottom: 1rem;
        }

        .flip-card-back {
            transform: rotateY(180deg);
        }

        .flip-card-back p {
            font-size: 1rem;
        }

        /* Toolkit & Code Template */
        .toolkit-container {
            display: flex;
            gap: 3rem;
            align-items: center;
            width: 100%;
            max-width: 1100px;
            margin-top: 2rem;
        }

        .toolkit-item {
            text-align: center;
            flex: 1;
        }

        .toolkit-item .material-icons {
            font-size: 10rem;
            color: var(--accent-blue);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        .code-explanation-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            flex: 2;
        }

        .code-view {
            display: flex;
            gap: 1rem;
            background-color: #1e1e1e;
            border: 1px solid #3c4043;
            border-radius: 12px;
            padding: 1rem;
            font-family: 'Fira Code', monospace;
            text-align: left;
            width: 100%;
        }

        .code-view pre {
            margin: 0;
            padding: 1rem;
            border-radius: 8px;
            transition: background-color 0.3s, border-left-color 0.3s;
            cursor: pointer;
            border-left: 4px solid #3c4043;
            flex: 1;
            font-size: 0.8rem;
        }

        .code-view pre:hover,
        .code-view pre.active {
            background-color: rgba(138, 180, 248, 0.1);
            border-left-color: var(--accent-blue);
        }

        .code-view .sh-keyword {
            color: #569cd6;
        }

        .code-view .sh-function {
            color: #dcdcaa;
        }

        .code-view .sh-type {
            color: #4ec9b0;
        }

        .code-view .sh-comment {
            color: #6a9955;
        }

        .code-view .sh-variable {
            color: #9cdcfe;
        }

        .code-view .sh-string {
            color: #ce9178;
        }

        .code-view .sh-literal {
            color: #b5cea8;
        }

        .code-view .sh-operator {
            color: #d4d4d4;
        }

        #code-explanation-box {
            background-color: var(--bg-surface);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: left;
            border-left: 4px solid var(--accent-green);
            min-height: 120px;
        }

        #code-explanation-box h4 {
            margin: 0 0 0.5rem 0;
            color: var(--accent-green);
        }

        #code-explanation-box p {
            margin: 0;
            font-size: clamp(0.9rem, 1.2vw, 1rem);
        }

        /* Core Components Slide */
        .component-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            width: 100%;
            max-width: 1100px;
            margin-top: 2rem;
        }

        .component-card {
            background-color: var(--bg-surface);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 1rem;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .component-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .component-card .material-icons {
            font-size: 4rem;
        }

        .component-card h4 {
            margin: 0;
            font-size: 1.2rem;
        }

        .component-card p {
            font-size: 0.9rem;
            margin: 0;
        }

        /* Your First Steps Slide */
        .steps-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2.5rem;
            width: 100%;
            max-width: 1100px;
            margin-top: 3rem;
        }

        .step-card {
            background-color: var(--bg-surface);
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
        }

        .step-card .material-icons {
            font-size: 4rem;
            color: var(--accent-blue);
            margin-bottom: 1rem;
        }

        .step-card h3 {
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .step-card p {
            font-size: 1rem;
        }

        .step-card code {
            background-color: var(--bg-dark);
            padding: 0.2rem 0.5rem;
            border-radius: 6px;
            font-family: 'Fira Code', monospace;
        }


        /* Mission Grid (CENTERED) */
        #mission-grid-container {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #mission-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            width: 100%;
            max-width: 1000px;
        }

        .mission-card {
            background-color: var(--bg-surface);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid transparent;
        }

        .mission-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border-color: var(--accent-blue);
        }

        .mission-card .material-icons {
            font-size: 4rem;
            color: var(--accent-blue);
        }

        .mission-card span {
            font-weight: 500;
        }

        #mission-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.4s;
        }

        #mission-modal-overlay.visible {
            display: flex;
            opacity: 1;
        }

        #mission-modal {
            background-color: var(--bg-surface);
            border-radius: 16px;
            padding: 2rem;
            max-width: 90vw;
            width: 700px;
            display: flex;
            gap: 2rem;
            align-items: center;
            transform: scale(0.8);
            transition: transform 0.4s;
            position: relative;
        }

        #mission-modal-overlay.visible #mission-modal {
            transform: scale(1);
        }

        #mission-modal-img {
            max-width: 250px;
            border-radius: 12px;
        }

        #mission-modal-text {
            text-align: left;
        }

        #mission-modal-text h3 {
            color: var(--accent-blue);
            margin-top: 0;
        }

        #mission-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            font-size: 24px;
            color: var(--text-secondary);
            transition: color 0.3s, transform 0.3s;
        }

        #mission-modal-close:hover {
            color: var(--text-primary);
            transform: rotate(90deg);
        }

        /* SLIDE 13: DIGITAL BRAIN (NEW CONCEPT) */
        /* SLIDE 13: DIGITAL BRAIN (MATERIAL REDESIGN) */
        #brain-container {
            background-color: transparent;
            padding: 1rem;
            width: 100%;
            max-width: 1100px;
            margin: 2rem auto 0 auto;
        }

        #routine-builder-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            gap: 2rem;
            min-height: 250px;
        }

        .builder-column {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .brain-node {
            display: flex;
            align-items: center;
            gap: 1rem;
            background-color: var(--bg-surface);
            padding: 1rem 1.5rem;
            border-radius: 28px;
            /* Material You pill shape */
            border: 1px solid #3c4043;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1.1rem;
        }

        .brain-node:hover {
            transform: translateY(-4px);
            background-color: #3c4043;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .brain-node .material-icons {
            font-size: 1.8rem;
            color: var(--accent-blue);
        }

        /* Node States */
        .brain-node.selected {
            background-color: var(--accent-blue);
            color: var(--bg-dark);
            font-weight: bold;
            border-color: var(--accent-blue);
            transform: scale(1.05);
        }

        .brain-node.selected .material-icons {
            color: var(--bg-dark);
        }

        .brain-node.disabled {
            opacity: 0.4;
            pointer-events: none;
            background-color: var(--bg-surface);
        }


        /* Central Hub */
        #brain-hub {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            grid-column: 2;
        }

        #brain-hub-icon {
            font-size: 8rem;
            color: var(--accent-blue);
            opacity: 0.4;
            z-index: 1;
            animation: pulse-hub 6s infinite ease-in-out;
        }

        @keyframes pulse-hub {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.4;
            }

            50% {
                transform: scale(1.05);
                opacity: 0.6;
            }
        }

        #brain-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: visible;
            z-index: 2;
        }

        #routine-path-line {
            fill: none;
            stroke: var(--accent-yellow);
            stroke-width: 5px;
            stroke-linecap: round;
            stroke-linejoin: round;
        }


        /* New Bottom Display Bar CSS */
        #routine-display-bar {
            background-color: var(--bg-dark);
            border: 1px solid #3c4043;
            border-radius: 16px;
            margin-top: 2rem;
            display: flex;
            justify-content: center;
            align-items: stretch;
            font-family: 'Fira Code', monospace;
            position: relative;
            min-height: 70px;
            overflow: hidden;
            padding: 0;
        }

        .routine-status-box {
            flex: 1;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #6c7177;
            /* Dimmed text color */
            transition: all 0.4s ease;
        }

        .routine-status-box:first-of-type {
            border-right: 1px solid #3c4043;
        }

        /* Active state for the status boxes */
        .routine-status-box.active {
            background-color: var(--bg-surface);
            color: var(--text-primary);
            font-weight: bold;
        }

        #routine-if-box.active {
            color: var(--accent-red);
        }

        #routine-then-box.active {
            color: var(--accent-green);
        }

        #routine-reset {
            position: absolute;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            pointer-events: none;
            z-index: 5;
            /* Ensure it's above the status boxes */
        }

        #routine-reset.visible {
            opacity: 1;
            pointer-events: all;
        }

        #routine-reset:hover {
            color: var(--text-primary);
            transform: translateY(-50%) rotate(180deg) scale(1.1);
        }

        /* Final CTA */
        .cta-button {
            background: linear-gradient(45deg, var(--accent-blue), var(--accent-green));
            color: var(--bg-dark);
            font-weight: bold;
            padding: 1rem 2rem;
            border-radius: 50px;
            text-decoration: none;
            transition: transform 0.3s, box-shadow 0.3s;
            display: inline-block;
        }

        .cta-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(138, 180, 248, 0.3);
        }

        #dashboard-container {
            width: 100%;
            max-width: 1200px;
        }

        #dashboard-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        #dashboard-controls .material-icons {
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.3s, transform 0.3s;
        }

        #dashboard-controls .material-icons:hover {
            color: var(--text-primary);
            transform: scale(1.1);
        }

        #dashboard-iframe-wrapper {
            width: 100%;
            height: 75vh;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 0 0 2px var(--bg-surface);
        }

        #dashboard-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background-color: #fff;
            transition: transform 0.3s ease;
            /* filter: invert(1) hue-rotate(180deg); */
        }
    </style>
</head>

<body>
    <div class="main-container">
        <div id="slide-nav">
            <i class="material-icons nav-arrow" id="nav-up">keyboard_arrow_up</i>
            <div id="nav-dots"></div>
            <i class="material-icons nav-arrow" id="nav-down">keyboard_arrow_down</i>
        </div>

        <!-- SLIDE 1: TITLE -->
        <section id="slide-1" class="slide">
            <div id="particles-js"></div>
            <div class="slide-content">
                <div id="logo-container" class="reveal">
                    <img id="mcmaster-logo" src="Assets/McMaster Logo White.png"
                        alt="McMaster W Booth School of Engineering Practice and Technology Logo">
                </div>
                <h1 class="reveal delay-1">Welcome, Future Engineers!</h1>
                <h2 class="reveal delay-2 subtitle">Let's build something amazing together.</h2>
            </div>
        </section>

        <!-- SLIDE 2: THE "WHY" -->
        <section id="slide-2" class="slide">
            <div class="slide-content">
                <h1 class="reveal">What if everyday objects could <span class="highlight">think and talk?</span></h1>
                <h2 class="reveal delay-1">This is the core idea of the <strong>Internet of Things (IoT)</strong>. It's
                    about giving a digital 'voice' to everything around us so they can communicate.
                </h2>
                <div id="iot-diagram" class="reveal delay-2">
                    <div id="iot-brain" class="iot-node"><i class="material-icons">psychology</i></div>
                    <div class="iot-node iot-satellite"
                        style="top: 50%; left: -25%; color: #fbbc05; animation-delay: 0.2s;">
                        <i class="material-icons">lightbulb</i>
                    </div>
                    <div class="iot-node iot-satellite"
                        style="top: 50%; left: 10%; color: #ea4335; animation-delay: 0.4s;">
                        <i class="material-icons">thermostat</i>
                    </div>
                    <div class="iot-node iot-satellite"
                        style="top: 50%; left: 90%; color: #34a853; animation-delay: 0.6s;">
                        <i class="material-icons">lock</i>
                    </div>
                    <div class="iot-node iot-satellite"
                        style="top: 50%; left: 125%; color: #e8eaed; animation-delay: 0.8s;">
                        <i class="material-icons">smartphone</i>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 3: ANATOMY OF A MESSAGE -->
        <section id="slide-3" class="slide">
            <div class="slide-content">
                <h1 class="reveal">The Anatomy of a Message</h1>
                <h2 class="reveal delay-1">Every message sent in our system has two simple parts: a <span
                        class="highlight">Topic</span> and a <span class="highlight">Payload</span>. Tap to learn more.
                </h2>
                <div class="message-anatomy-container reveal delay-2">
                    <div class="message-part topic" onclick="showExplanation('topic')">
                        <div class="label">Topic</div>
                        <div class="value">"classroom/lights"</div>
                    </div>
                    <div class="message-part payload" onclick="showExplanation('payload')">
                        <div class="label">Payload</div>
                        <div class="value">"ON"</div>
                    </div>
                </div>
                <div id="message-explanation" class="reveal delay-3">
                    <p>Select a part to see its description.</p>
                </div>
            </div>
        </section>

        <!-- SLIDE 4: CODE TO CLOUD -->
        <section id="slide-4" class="slide">
            <div class="slide-content">
                <h1 class="reveal">From Code to Cloud</h1>
                <h2 class="reveal delay-1">Let's visualize the entire journey of a single piece of data, from your
                    device to the dashboard.</h2>
                <div id="code-to-cloud-diagram" class="reveal delay-2">
                    <div class="arch-node">
                        <i class="material-icons" style="color:var(--accent-blue)">code</i>
                        <span>Your Code</span>
                    </div>
                    <div class="arch-node">
                        <i class="material-icons" style="color:var(--accent-blue)">memory</i>
                        <span>ESP8266</span>
                    </div>
                    <div class="arch-node">
                        <i class="material-icons" style="color:var(--accent-yellow)">wifi</i>
                        <span>Network</span>
                    </div>
                    <div class="arch-node">
                        <i class="material-icons" style="color:var(--accent-red)">hub</i>
                        <span>MQTT Hub</span>
                    </div>
                    <div class="arch-node">
                        <i class="material-icons" style="color:var(--accent-green)">dashboard</i>
                        <span>Dashboard</span>
                    </div>
                    <div class="line-container">
                        <svg>
                            <path id="arch-path" d="M 0 2 H 800" stroke="#444" stroke-width="4" stroke-dasharray="10"
                                fill="none" />
                        </svg>
                        <div class="data-packet"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 5: NETWORK ARCHITECTURES -->
        <section id="slide-5" class="slide">
            <div class="slide-content">
                <h1 class="reveal">How do devices talk?</h1>
                <h2 class="reveal delay-1">For IoT, we need a special way for devices to communicate that is fast and
                    efficient.</h2>
                <div class="comparison-grid">
                    <div class="grid-card reveal delay-2">
                        <h3><i class="material-icons">person</i>Client-Server Model</h3>
                        <p>A client makes a direct request to a server. The server sends a direct response back to that
                            one client.</p>
                        <p class="analogy">Analogy: Ordering from a catalog. You know exactly who to ask, and they send
                            the item directly back to you.</p>
                    </div>
                    <div class="grid-card reveal delay-3">
                        <h3><i class="material-icons">forum</i>Publish/Subscribe Model</h3>
                        <p>Devices "publish" messages to a central hub, not knowing who will receive them. Other devices
                            "subscribe" to topics they care about.</p>
                        <p class="analogy">Analogy: A smart post office. You drop mail in a mailbox (topic), and the
                            post office (hub) delivers it to everyone who subscribed to that address.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 6: MQTT DEEP DIVE (FIXED) -->
        <section id="slide-6" class="slide">
            <div class="slide-content">
                <h1 class="reveal">Our Language: <span class="highlight">MQTT</span></h1>
                <h2 class="reveal delay-1">We'll use Publish/Subscribe with MQTT. It's fast, lightweight, and perfect
                    for our project. <br><strong>Tap the devices to see how they communicate!</strong></h2>
                <div id="mqtt-container" class="reveal delay-2">
                    <div id="mqtt-diagram">
                        <svg>
                            <path id="sensor-to-broker" class="anim-path"></path>
                            <path id="broker-to-light" class="anim-path"></path>
                            <path id="broker-to-dash" class="anim-path"></path>
                            <path id="dash-to-broker" class="anim-path"></path>
                        </svg>
                        <div id="mqtt-sensor" class="mqtt-element"
                            onclick="publishFrom(this, 'thermostat', 'sensor-to-broker')">
                            <i class="material-icons" style="color: var(--accent-red);">thermostat</i>
                            <span>Temp Sensor</span>
                        </div>
                        <div id="mqtt-broker" class="mqtt-element">
                            <i class="material-icons" style="font-size: 6rem;">hub</i>
                            <span>MQTT Hub</span>
                        </div>
                        <div id="mqtt-actuator" class="mqtt-element" onclick="toggleSubscription(this)">
                            <i class="material-icons" style="color: var(--text-primary);">lightbulb</i>
                            <span>Smart Light</span>
                        </div>
                        <div id="mqtt-dashboard" class="mqtt-element subscribed"
                            onclick="publishFrom(this, 'lightbulb', 'dash-to-broker')">
                            <i class="material-icons">smartphone</i>
                            <span>Dashboard</span>
                            <div class="dashboard-display">21.5°C</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 7: REAL WORLD IOT -->
        <section id="slide-7" class="slide">
            <div class="slide-content">
                <h1 class="reveal">IoT is Everywhere</h1>
                <h2 class="reveal delay-1">The concepts you're learning today power technology all around the world. Tap
                    the cards to see how.</h2>
                <div class="real-world-grid reveal delay-2">
                    <div class="flip-card" onclick="this.classList.toggle('is-flipped')">
                        <div class="flip-card-inner">
                            <div class="flip-card-front">
                                <i class="material-icons" style="color:var(--accent-green)">home</i>
                                <h3>Smart Home</h3>
                            </div>
                            <div class="flip-card-back">
                                <h3>Smart Home</h3>
                                <p>Devices like thermostats, lights, and locks talk to each other to automate your home
                                    and save energy.</p>
                            </div>
                        </div>
                    </div>
                    <div class="flip-card" onclick="this.classList.toggle('is-flipped')">
                        <div class="flip-card-inner">
                            <div class="flip-card-front">
                                <i class="material-icons" style="color:var(--accent-blue)">location_city</i>
                                <h3>Smart Cities</h3>
                            </div>
                            <div class="flip-card-back">
                                <h3>Smart Cities</h3>
                                <p>Sensors monitor traffic, manage streetlights, and check air quality to make cities
                                    safer and more efficient.</p>
                            </div>
                        </div>
                    </div>
                    <div class="flip-card" onclick="this.classList.toggle('is-flipped')">
                        <div class="flip-card-inner">
                            <div class="flip-card-front">
                                <i class="material-icons" style="color:var(--accent-red)">agriculture</i>
                                <h3>Smart Agriculture</h3>
                            </div>
                            <div class="flip-card-back">
                                <h3>Smart Agriculture</h3>
                                <p>Soil sensors and automated irrigation systems help farmers grow more food while using
                                    less water.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 8: YOUR MISSION -->
        <section id="slide-8" class="slide">
            <div class="slide-content">
                <h1 class="reveal">Your Mission: <span class="highlight">Build a Living Classroom</span></h1>
                <h2 class="reveal delay-1">You are a team of specialists. Your goal is to bring a smart classroom to
                    life. Each team has a critical system to build. When you're done, all your individual parts will
                    work together as one intelligent system.</h2>
            </div>
        </section>

        <!-- SLIDE 9: TOOLKIT -->
        <section id="slide-9" class="slide">
            <div class="slide-content">
                <h1 class="reveal">Your Toolkit & Template</h1>
                <h2 class="reveal delay-1">You have your brain (the ESP8266) and your language (the Arduino IDE). We've
                    handled the complex networking, so you only need to focus on three core functions. Click each
                    function to learn more!</h2>
                <div class="toolkit-container reveal delay-2">
                    <div class="toolkit-item">
                        <i class="material-icons">memory</i>
                        <h3>The Brain: ESP8266</h3>
                    </div>
                    <div class="code-explanation-container">
                        <div class="code-view">
                            <pre id="code-setup" onclick="highlightCode(this)"><code><span class="sh-comment">// Runs ONCE</span>
<span class="sh-keyword">void</span> <span class="sh-function">setupDevice</span>(){
  <span class="sh-comment">//...setup hardware...</span>
}</code></pre>
                            <pre id="code-read" onclick="highlightCode(this)"><code><span class="sh-comment">// Runs REPEATEDLY</span>
<span class="sh-keyword">void</span> <span class="sh-function">readSensor</span>(){
  <span class="sh-comment">//...read & publish...</span>
}</code></pre>
                            <pre id="code-trigger" onclick="highlightCode(this)"><code><span class="sh-comment">// Runs ON COMMAND</span>
<span class="sh-keyword">void</span> <span class="sh-function">triggerActuator</span>(){
  <span class="sh-comment">//...react & control...</span>
}</code></pre>
                        </div>
                        <div id="code-explanation-box">
                            <h4 id="explanation-title"></h4>
                            <p id="explanation-text"></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 10: CORE COMPONENTS -->
        <section id="slide-10" class="slide">
            <div class="slide-content">
                <h1 class="reveal">Your Core Components</h1>
                <h2 class="reveal delay-1">These are the building blocks you'll use to bring your station to life.</h2>
                <div class="component-grid reveal delay-2">
                    <div class="component-card">
                        <i class="material-icons" style="color: var(--accent-blue);">memory</i>
                        <h4>ESP8266</h4>
                        <p>The Wi-Fi enabled microcontroller that acts as the brain for your device.</p>
                    </div>
                    <div class="component-card">
                        <i class="material-icons" style="color: var(--accent-red);">sensors</i>
                        <h4>Sensors</h4>
                        <p>The 'senses' of your device. They read data from the environment (e.g., temperature, motion).
                        </p>
                    </div>
                    <div class="component-card">
                        <i class="material-icons" style="color: var(--accent-green);">toggle_on</i>
                        <h4>Actuators</h4>
                        <p>The 'muscles' of your device. They perform actions (e.g., turn on a light, move a motor).</p>
                    </div>
                    <div class="component-card">
                        <i class="material-icons" style="color: var(--accent-yellow);">cable</i>
                        <h4>I2C Modules</h4>
                        <p>Pre-programmed controllers that handle complex tasks, managed by your ESP8266.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 11: NEW - YOUR FIRST STEPS -->
        <section id="slide-11" class="slide">
            <div class="slide-content">
                <h1 class="reveal">Your First Steps</h1>
                <h2 class="reveal delay-1">Let's get your workstation ready for action.</h2>
                <div class="steps-grid reveal delay-2">
                    <div class="step-card">
                        <i class="material-icons">build_circle</i>
                        <h3>1. Check Your Kit</h3>
                        <p>Make sure you have your ESP8266, USB cable, and all the specific hardware for your assigned
                            station.</p>
                    </div>
                    <div class="step-card">
                        <i class="material-icons">folder_open</i>
                        <h3>2. Open the Template</h3>
                        <p>In the Arduino IDE, go to
                            <br><code>File > Examples </code><br><code> > SmartDevice </code><br><code> > UniversalDeviceTemplate</code>
                        </p>
                    </div>
                    <div class="step-card">
                        <i class="material-icons">edit_note</i>
                        <h3>3. Find Your Sections</h3>
                        <p>Scroll through the code. Your job is to fill in the 5 numbered sections. Don't touch the
                            <code>System Engine</code>!
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 12: MISSIONS (CENTERED) -->
        <section id="slide-12" class="slide">
            <div id="mission-grid-container" class="slide-content reveal">
                <h1>One Team, Six Missions</h1>
                <div id="mission-grid">
                    <div class="mission-card" data-mission="1">
                        <i class="material-icons">ac_unit</i>
                        <span>HVAC & Appliances</span>
                    </div>
                    <div class="mission-card" data-mission="2">
                        <i class="material-icons">thermostat</i>
                        <span>Environmental Sensors</span>
                    </div>
                    <div class="mission-card" data-mission="3">
                        <i class="material-icons">lightbulb</i>
                        <span>Lighting & Indicators</span>
                    </div>
                    <div class="mission-card" data-mission="4">
                        <i class="material-icons">lock</i>
                        <span>Door Security</span>
                    </div>
                    <div class="mission-card" data-mission="5">
                        <i class="material-icons">blinds_closed</i>
                        <span>Automated Curtain</span>
                    </div>
                    <div class="mission-card" data-mission="6">
                        <i class="material-icons">tune</i>
                        <span>Master Control Panel</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 13: DIGITAL BRAIN -->
        <section id="slide-13" class="slide">
            <div class="slide-content">
                <h1 class="reveal">Routines: The Digital Brain</h1>
                <h2 class="reveal delay-1">Smart devices follow simple rules: <span class="highlight">IF</span> a
                    trigger happens, <span class="highlight">THEN</span> perform an action. <br>Build a routine by
                    picking a trigger, then an action.</h2>

                <div id="brain-container" class="reveal delay-2">
                    <div id="routine-builder-grid">
                        <div class="builder-column" id="trigger-column">
                            <div class="brain-node trigger" onclick="selectBrainNode(this, 'trigger')">
                                <i class="material-icons">directions_walk</i>
                                <span class="brain-node-text">Motion is Detected</span>
                            </div>
                            <div class="brain-node trigger" onclick="selectBrainNode(this, 'trigger')">
                                <i class="material-icons">schedule</i>
                                <span class="brain-node-text">It's 7:00 PM</span>
                            </div>
                            <div class="brain-node trigger" onclick="selectBrainNode(this, 'trigger')">
                                <i class="material-icons">thermostat</i>
                                <span class="brain-node-text">Temp > 24°C</span>
                            </div>
                        </div>

                        <div id="brain-hub">
                            <svg id="brain-svg">
                                <defs>
                                    <filter id="routine-glow" x="-50%" y="-50%" width="200%" height="200%">
                                        <feGaussianBlur stdDeviation="4" result="coloredBlur" />
                                        <feMerge>
                                            <feMergeNode in="coloredBlur" />
                                            <feMergeNode in="SourceGraphic" />
                                        </feMerge>
                                    </filter>
                                </defs>
                                <path id="routine-path-line" filter="url(#routine-glow)" />
                            </svg>
                            <i id="brain-hub-icon" class="material-icons">hub</i>
                        </div>

                        <div class="builder-column" id="action-column">
                            <div class="brain-node action" onclick="selectBrainNode(this, 'action')">
                                <i class="material-icons">lightbulb</i>
                                <span class="brain-node-text">Turn on Lights</span>
                            </div>
                            <div class="brain-node action" onclick="selectBrainNode(this, 'action')">
                                <i class="material-icons">lock</i>
                                <span class="brain-node-text">Lock the Door</span>
                            </div>
                            <div class="brain-node action" onclick="selectBrainNode(this, 'action')">
                                <i class="material-icons">wind_power</i>
                                <span class="brain-node-text">Activate Fan</span>
                            </div>
                        </div>
                    </div>

                    <div id="routine-display-bar">
                        <div id="routine-if-box" class="routine-status-box">
                            <span>IF...</span>
                        </div>
                        <div id="routine-then-box" class="routine-status-box">
                            <span>THEN...</span>
                        </div>
                        <i id="routine-reset" class="material-icons" onclick="resetBrainRoutine()">refresh</i>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 14: FINAL -->
        <section id="slide-14" class="slide">
            <div class="slide-content">
                <h1 class="reveal">Ready to Build the Future?</h1>
                <h2 class="reveal delay-1" style="color: var(--accent-green);">Let's get started!</h2>
                <a href="#slide-15" id="dashboard-cta" class="cta-button reveal delay-2">Go to Dashboard</a>
            </div>
        </section>

        <!-- SLIDE 15: DASHBOARD -->
        <section id="slide-15" class="slide">
            <div id="dashboard-container" class="slide-content">
                <h1 class="reveal">Live Classroom Dashboard</h1>
                <div id="dashboard-iframe-wrapper" class="reveal delay-2">
                    <iframe id="dashboard-iframe"
                        src="https://app.arduino.cc/dashboards/1a8b5e9a-4e44-4828-8583-8557347a550a"
                        frameborder="0"></iframe>
                </div>
            </div>
        </section>
    </div>

    <!-- Mission Modal Structure -->
    <div id="mission-modal-overlay">
        <div id="mission-modal">
            <i id="mission-modal-close" class="material-icons">close</i>
            <img id="mission-modal-img" src="" alt="Mission Diagram">
            <div id="mission-modal-text">
                <h3 id="mission-modal-title"></h3>
                <p id="mission-modal-desc"></p>
                <p><strong>Hardware:</strong> <span id="mission-modal-hardware"></span></p>
            </div>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        // --- SLIDE 13: GLOBAL VARIABLES & FUNCTIONS ---
        // These are defined globally so the HTML onclick attributes can find them.
        const brainRoutineState = {
            trigger: null,
            action: null,
            isAnimating: false
        };
        let brainNodes = {}; // This will be populated once the DOM is loaded.

        window.selectBrainNode = function (el, type) {
            if (brainRoutineState.isAnimating) return;
            if (type === 'trigger' && brainRoutineState.trigger) return;
            if (type === 'action' && !brainRoutineState.trigger) return;

            el.classList.add('selected');
            const nodeText = el.querySelector('.brain-node-text').textContent;

            if (type === 'trigger') {
                brainRoutineState.trigger = { el: el, text: nodeText };
                brainNodes.displayIf.classList.add('active');
                brainNodes.displayIf.querySelector('span').textContent = `IF: ${nodeText}`;
                brainNodes.triggers.forEach(n => { if (n !== el) n.classList.add('disabled'); });
                brainNodes.actions.forEach(n => n.classList.remove('disabled'));
            } else {
                brainRoutineState.action = { el: el, text: nodeText };
                brainNodes.displayThen.classList.add('active');
                brainNodes.displayThen.querySelector('span').textContent = `THEN: ${nodeText}`;
                brainNodes.actions.forEach(n => { if (n !== el) n.classList.add('disabled'); });
                createRoutinePath();
            }
        };

        window.resetBrainRoutine = function () {
            if (brainRoutineState.isAnimating) return;

            brainRoutineState.trigger = null;
            brainRoutineState.action = null;

            brainNodes.triggers.forEach(n => n.classList.remove('selected', 'disabled'));
            brainNodes.actions.forEach(n => n.classList.remove('selected', 'disabled'));
            brainNodes.actions.forEach(n => n.classList.add('disabled'));

            brainNodes.displayIf.classList.remove('active');
            brainNodes.displayIf.querySelector('span').textContent = 'IF...';
            brainNodes.displayThen.classList.remove('active');
            brainNodes.displayThen.querySelector('span').textContent = 'THEN...';
            brainNodes.resetBtn.classList.remove('visible');

            anime({
                targets: brainNodes.path,
                strokeDashoffset: [anime.setDashoffset, anime.setDashoffset],
                duration: 400,
                easing: 'easeInOutSine',
                complete: () => {
                    brainNodes.path.setAttribute('d', '');
                }
            });
        };

        // Corrected Path Creation Function
        function createRoutinePath() {
            brainRoutineState.isAnimating = true;

            const svgRect = brainNodes.svg.getBoundingClientRect();
            const triggerRect = brainRoutineState.trigger.el.getBoundingClientRect();
            const actionRect = brainRoutineState.action.el.getBoundingClientRect();
            const hubRect = brainNodes.hub.getBoundingClientRect();

            // Convert all coordinates to be relative to the SVG container's top-left corner
            const hubCenter = {
                x: hubRect.left + hubRect.width / 2 - svgRect.left,
                y: hubRect.top + hubRect.height / 2 - svgRect.top
            };
            const startPoint = {
                x: triggerRect.right - svgRect.left,
                y: triggerRect.top + triggerRect.height / 2 - svgRect.top
            };
            const endPoint = {
                x: actionRect.left - svgRect.left,
                y: actionRect.top + actionRect.height / 2 - svgRect.top
            };

            // Create a smooth quadratic curve through the hub
            // M = Move to start
            // Q = Quadratic bezier curve (control point, end point)
            const pathData = `M ${startPoint.x} ${startPoint.y} Q ${hubCenter.x} ${hubCenter.y} ${endPoint.x} ${endPoint.y}`;
            brainNodes.path.setAttribute('d', pathData);

            // Animate the path drawing
            anime({
                targets: brainNodes.path,
                strokeDashoffset: [anime.setDashoffset, 0],
                duration: 1200,
                easing: 'easeInOutCubic',
                complete: () => {
                    brainRoutineState.isAnimating = false;
                    brainNodes.resetBtn.classList.add('visible');
                }
            });
        }

        // --- MAIN SCRIPT INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            const mainContainer = document.querySelector('.main-container');
            const slides = document.querySelectorAll('.slide');
            const navDotsContainer = document.getElementById('nav-dots');
            let currentSlide = 0;

            // --- Particle JS ---
            if (document.getElementById('particles-js')) {
                particlesJS('particles-js', { particles: { number: { value: 60, density: { enable: true, value_area: 800 } }, color: { value: "#8ab4f8" }, shape: { type: "circle" }, opacity: { value: 0.4, random: true, anim: { enable: true, speed: 1, opacity_min: 0.1, sync: false } }, size: { value: 3, random: true }, line_linked: { enable: true, distance: 150, color: "#8ab4f8", opacity: 0.3, width: 1 }, move: { enable: true, speed: 1, direction: "none", random: false, straight: false, out_mode: "out" } }, interactivity: { detect_on: "canvas", events: { onhover: { enable: true, mode: "grab" }, onclick: { enable: false }, resize: true }, modes: { grab: { distance: 140, line_linked: { opacity: 0.8 } } } }, retina_detect: true });
            }

            // --- Slide Navigation ---
            const updateNav = () => {
                const scrollPosition = mainContainer.scrollTop;
                const newSlideIndex = Math.round(scrollPosition / window.innerHeight);

                if (currentSlide !== newSlideIndex) {
                    currentSlide = newSlideIndex;
                    document.querySelectorAll('.nav-dot').forEach((dot, index) => {
                        dot.classList.toggle('active', index === currentSlide);
                    });
                }
            };

            slides.forEach((slide, index) => {
                const dot = document.createElement('div');
                dot.classList.add('nav-dot');
                dot.addEventListener('click', () => {
                    mainContainer.scrollTo({ top: index * window.innerHeight, behavior: 'smooth' });
                });
                navDotsContainer.appendChild(dot);
            });

            document.getElementById('nav-up').addEventListener('click', () => mainContainer.scrollTo({ top: Math.max(0, currentSlide - 1) * window.innerHeight, behavior: 'smooth' }));
            document.getElementById('nav-down').addEventListener('click', () => mainContainer.scrollTo({ top: Math.min(slides.length - 1, currentSlide + 1) * window.innerHeight, behavior: 'smooth' }));
            document.getElementById('dashboard-cta').addEventListener('click', (e) => {
                e.preventDefault();
                mainContainer.scrollTo({ top: (slides.length - 1) * window.innerHeight, behavior: 'smooth' });
            });

            mainContainer.addEventListener('scroll', updateNav);
            updateNav();

            // --- Intersection Observer for Animations ---
            let codeToCloudAnim = null;
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        if (entry.target.id === 'slide-4' && !codeToCloudAnim) {
                            const packet = document.querySelector('.data-packet');
                            packet.style.opacity = 1;
                            codeToCloudAnim = anime({
                                targets: packet,
                                translateX: anime.path('#arch-path')('x'),
                                easing: 'easeInOutSine',
                                duration: 5000,
                                loop: true,
                            });
                        }
                    } else {
                        entry.target.classList.remove('is-visible');
                    }
                });
            }, { threshold: 0.6 });
            slides.forEach(slide => observer.observe(slide));

            // --- Slide 3: Message Anatomy ---
            const msgExplanations = {
                topic: { title: "The Topic is the Address", text: "It tells the MQTT Hub exactly where to deliver the message. Other devices subscribe to this specific address to receive the data." },
                payload: { title: "The Payload is the Data", text: "This is the actual information being sent. It can be a simple string like 'ON', a number for a sensor reading, or even complex data." }
            };
            window.showExplanation = (part) => {
                const explanationBox = document.getElementById('message-explanation');
                explanationBox.style.opacity = 0;
                setTimeout(() => {
                    explanationBox.innerHTML = `<h3>${msgExplanations[part].title}</h3><p>${msgExplanations[part].text}</p>`;
                    explanationBox.style.opacity = 1;
                }, 200);
            };

            // --- Slide 6: MQTT Interactivity ---
            let isMqttAnimating = false;
            let isLightOn = false;
            const mqttElements = {
                actuator: document.getElementById('mqtt-actuator'),
                dashboard: document.getElementById('mqtt-dashboard'),
                broker: document.getElementById('mqtt-broker')
            };
            const lightIcon = mqttElements.actuator.querySelector('.material-icons');
            const dashboardDisplay = mqttElements.dashboard.querySelector('.dashboard-display');

            function animateBubble(startElement, endElement, icon, onComplete) {
                const diagram = document.getElementById('mqtt-diagram');
                const bubble = document.createElement('div');
                bubble.classList.add('message-bubble');
                bubble.innerHTML = `<i class="material-icons">${icon}</i>`;
                diagram.appendChild(bubble);

                const diagramRect = diagram.getBoundingClientRect();
                const startRect = startElement.getBoundingClientRect();
                const endRect = endElement.getBoundingClientRect();
                const startPos = { x: startRect.left + startRect.width / 2 - diagramRect.left, y: startRect.top + startRect.height / 2 - diagramRect.top };
                const endPos = { x: endRect.left + endRect.width / 2 - diagramRect.left, y: endRect.top + endRect.height / 2 - diagramRect.top };

                bubble.style.opacity = 1;
                anime({
                    targets: bubble, left: [startPos.x, endPos.x], top: [startPos.y, endPos.y], opacity: [1, 0], duration: 1200, easing: 'easeInOutCubic',
                    complete: () => {
                        bubble.remove();
                        if (onComplete) onComplete();
                    }
                });
            }
            window.publishFrom = (sourceDiv, icon) => {
                if (isMqttAnimating) return;
                isMqttAnimating = true;
                const sourceIcon = sourceDiv.querySelector('.material-icons');
                const brokerIcon = mqttElements.broker.querySelector('.material-icons');
                animateBubble(sourceIcon, brokerIcon, icon, () => {
                    anime({ targets: mqttElements.broker, scale: [1, 1.1, 1], duration: 500 });
                    if (icon === 'thermostat' && mqttElements.dashboard.classList.contains('subscribed')) {
                        dashboardDisplay.textContent = `${(Math.random() * 5 + 20).toFixed(1)}°C`;
                        animateBubble(brokerIcon, mqttElements.dashboard.querySelector('.material-icons'), 'thermostat');
                    }
                    if (icon === 'lightbulb' && mqttElements.actuator.classList.contains('subscribed')) {
                        animateBubble(brokerIcon, mqttElements.actuator.querySelector('.material-icons'), 'lightbulb', () => {
                            isLightOn = !isLightOn;
                            lightIcon.style.color = isLightOn ? 'var(--accent-yellow)' : 'var(--text-primary)';
                        });
                    }
                    setTimeout(() => { isMqttAnimating = false; }, 800);
                });
            };
            window.toggleSubscription = (el) => el.classList.toggle('subscribed');

            // --- Slide 9: Code View Highlighting ---
            const explanations = {
                setup: { title: "setupDevice() - The Foundation", text: "This function runs only ONCE when your device first powers on. Use it to prepare your hardware, like setting pin modes for LEDs and sensors, and telling the hub which MQTT topics you want to listen to." },
                read: { title: "readSensor() - The Observer", text: "This function runs REPEATEDLY in a loop. It's perfect for constantly checking sensor values (like temperature) and 'publishing' that data to the hub for everyone else to see." },
                trigger: { title: "triggerActuator() - The Reactor", text: "This function only runs ON COMMAND, when a message arrives from a topic you subscribed to. Use this to react to commands and control actuators, like turning a light on or off." }
            };
            const explanationTitleEl = document.getElementById('explanation-title');
            const explanationTextEl = document.getElementById('explanation-text');
            window.highlightCode = (el) => {
                document.querySelectorAll('.code-view pre').forEach(e => e.classList.remove('active'));
                el.classList.add('active');
                const key = el.id.split('-')[1];
                explanationTitleEl.textContent = explanations[key].title;
                explanationTextEl.textContent = explanations[key].text;
            };
            highlightCode(document.getElementById('code-setup'));

            // --- Slide 12: Mission Modal ---
            const missionData = {
                1: { title: "HVAC & Appliances", desc: "Control high-power devices like a fan and kettle using relay modules, which act as smart switches.", hardware: "ESP8266, Relay Modules", img: "Assets/station1-diagram.png" },
                2: { title: "Environmental Sensors", desc: "Monitor the classroom’s temperature, humidity, and motion, sending all data to the central hub for automated responses.", hardware: "ESP8266, DHT11, PIR Sensor", img: "Assets/station2-diagram.png" },
                3: { title: "Lighting & Indicators", desc: "Control multi-color LED strips and the main security tower light, responding to commands from the cloud to change color and brightness.", hardware: "ESP8266, NeoPixel Strip, Tower Light", img: "Assets/station3-diagram.png" },
                4: { title: "Door Security", desc: "Act as the brains of the security system, communicating over the I2C protocol with a dedicated door controller to manage locks.", hardware: "ESP8266, I2C Door Controller", img: "Assets/station4-diagram.png" },
                5: { title: "Automated Curtain", desc: "Manage a high-precision stepper motor by commanding a dedicated I2C controller to calibrate and move to specific percentages.", hardware: "ESP8266, I2C Stepper Controller", img: "Assets/station5-diagram.png" },
                6: { title: "Master Control Panel", desc: "Build a universal remote that sends commands to all other stations and uses relays to light up indicators showing their status.", hardware: "ESP8266, Buttons, 4-Ch Relay", img: "Assets/station6-diagram.png" }
            };
            const modalOverlay = document.getElementById('mission-modal-overlay');
            document.querySelectorAll('.mission-card').forEach(card => {
                card.addEventListener('click', () => {
                    const missionId = card.dataset.mission;
                    const data = missionData[missionId];
                    document.getElementById('mission-modal-title').textContent = data.title;
                    document.getElementById('mission-modal-desc').textContent = data.desc;
                    document.getElementById('mission-modal-hardware').textContent = data.hardware;
                    document.getElementById('mission-modal-img').src = data.img;
                    modalOverlay.classList.add('visible');
                });
            });
            document.getElementById('mission-modal-close').addEventListener('click', () => modalOverlay.classList.remove('visible'));
            modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) modalOverlay.classList.remove('visible'); });

            // --- SLIDE 13: INITIALIZATION ---
            const slide13El = document.getElementById('slide-13');
            if (slide13El) {
                brainNodes = {
                    triggers: slide13El.querySelectorAll('.brain-node.trigger'),
                    actions: slide13El.querySelectorAll('.brain-node.action'),
                    displayIf: slide13El.querySelector('#routine-if-box'),
                    displayThen: slide13El.querySelector('#routine-then-box'),
                    resetBtn: slide13El.querySelector('#routine-reset'),
                    path: slide13El.querySelector('#routine-path-line'),
                    svg: slide13El.querySelector('#brain-svg'),
                    hub: slide13El.querySelector('#brain-hub-icon')
                };
                brainNodes.actions.forEach(n => n.classList.add('disabled'));
                const slide13Observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (!entry.isIntersecting && brainRoutineState.trigger) {
                            setTimeout(window.resetBrainRoutine, 200);
                        }
                    });
                }, { threshold: 0.5 });
                slide13Observer.observe(slide13El);
            }

            // --- Final Slide: Dashboard Controls ---
            const iframe = document.getElementById('dashboard-iframe');
            let currentZoom = 1;
            document.getElementById('dash-refresh').addEventListener('click', () => { iframe.src = iframe.src; });
            document.getElementById('dash-zoom-in').addEventListener('click', () => { currentZoom += 0.1; iframe.style.transform = `scale(${currentZoom})`; });
            document.getElementById('dash-zoom-out').addEventListener('click', () => { currentZoom = Math.max(0.5, currentZoom - 0.1); iframe.style.transform = `scale(${currentZoom})`; });
            document.getElementById('dash-zoom-reset').addEventListener('click', () => { currentZoom = 1; iframe.style.transform = `scale(${currentZoom})`; });
        });
    </script>
</body>

</html>